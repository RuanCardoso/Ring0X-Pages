import{j as e,a as s,P as a,i as t,u as r,d as n,b as l}from"./radix-vendor-7IO1Nbx6.js";import{D as o,a as i,b as c,c as d,d as u,e as x,f as m}from"./dialog-BPHeBbwo.js";import{x as h,L as g,a as p,y as b,z as j,F as f,D as v,X as N,d as w,I as y,E as C,w as S,J as k,K as E,N as O,O as D,Q as T,V as I,W as L,Y as A,_ as z,U as P,p as R,$ as U,a0 as _}from"./utils--9QnDWEM.js";import{b as $,j as q,A as M,a as B,C as F,d as J,e as G,c as V}from"./logo-DTWrhTh-.js";import{B as H,c as K}from"./index-Brba88ky.js";import{I as Y,P as Q,S as W,B as X}from"./m_sidebar-rqhseD1e.js";import{u as Z}from"./index-CsQcsRtG.js";import"./react-vendor-DG3TdhJH.js";const ee=async(e,s={})=>{const a={"Content-Type":"application/json",Authorization:`Bearer ${q()}`,...s.headers},t=await fetch(e,{...s,headers:a});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.message||`HTTP error! status: ${t.status}`)}return t.json()},se=async()=>await ee($.CATEGORIES,{method:"GET"}),ae=async(e,s)=>await ee($.CATEGORIES_CREATE,{method:"POST",body:JSON.stringify({name:e,description:s})}),te=async(e,s,a)=>await ee($.CATEGORIES_UPDATE,{method:"POST",body:JSON.stringify({id:e,name:s,description:a})}),re=async e=>await ee($.CATEGORIES_DELETE,{method:"POST",body:JSON.stringify({id:e})}),ne=async(e,s,a)=>await ee($.COURSES_CREATE,{method:"POST",body:JSON.stringify({categoryId:e,title:s,description:a})}),le=async(e,s,a)=>await ee($.COURSES_UPDATE,{method:"POST",body:JSON.stringify({id:e,title:s,description:a})}),oe=async e=>await ee($.COURSES_DELETE,{method:"POST",body:JSON.stringify({id:e})}),ie=async(e,s,a,t)=>await ee($.LESSONS_CREATE,{method:"POST",body:JSON.stringify({courseId:e,title:s,duration:a,description:t})}),ce=async(e,s,a,t,r)=>await ee($.LESSONS_UPDATE,{method:"POST",body:JSON.stringify({id:e,title:s,duration:a,description:t,isPaid:r})}),de=async e=>await ee($.LESSONS_DELETE,{method:"POST",body:JSON.stringify({id:e})}),ue=async e=>await ee(`${$.COURSES_BY_CATEGORY}?categoryId=${e}`,{method:"GET"}),xe=async e=>await ee(`${$.LESSONS_BY_COURSE}?courseId=${e}`,{method:"GET"}),me=async(e,s,a)=>await(async(e,s,a,t)=>{const r=q(),n=52428800,l=Math.ceil(s.size/n),o=async(s,n,l)=>{const o=new FormData;o.append("video",s);const i={lessonId:t,chunkIndex:n,totalChunks:l},c=new Blob([JSON.stringify(i)],{type:"application/json"}),d=new File([c],"videoPath.json",{type:"application/json"});return o.append("videoPath",d),new Promise((s,t)=>{const i=new XMLHttpRequest;a&&i.upload.addEventListener("progress",e=>{if(e.lengthComputable){const s=n/l*100,t=e.loaded/e.total*(100/l),r=Math.round(s+t),o=Math.min(r,95);a(o)}}),i.addEventListener("load",()=>{if(i.status>=200&&i.status<300)try{const e=JSON.parse(i.responseText);s(e)}catch(e){t(new Error("Resposta inválida do servidor"))}else try{const e=JSON.parse(i.responseText);t(new Error(e.message||`HTTP error! status: ${i.status}`))}catch{t(new Error(`HTTP error! status: ${i.status}`))}}),i.addEventListener("error",()=>{t(new Error("Erro de conexão"))}),i.open("POST",e),i.setRequestHeader("Authorization",`Bearer ${r}`),i.send(o)})};try{let e=null;for(let t=0;t<l;t++){const r=t*n,c=Math.min(r+n,s.size),d=s.slice(r,c);try{e=await o(d,t,l),t===l-1&&a&&a(100)}catch(i){throw new Error(`Erro ao fazer upload da parte ${t+1}/${l}: ${i.message}`)}}return e||{StatusCode:200,StatusMessage:"Upload concluído com sucesso"}}catch(i){throw i}})($.VIDEO_UPLOAD,e,s,a),he=async()=>{try{const e=await ee($.VIDEO_PROCESSING_STATUS,{method:"GET"});return"string"==typeof e?"true"===e.toLowerCase():e&&"object"==typeof e?"true"===e.status||"true"===e.result||"true"===e.data:"true"===String(e).toLowerCase()}catch(e){return!1}};function ge({isOpen:s,onOpenChange:a,categoryName:t,onCategoryNameChange:r,categoryDescription:n,onCategoryDescriptionChange:l,onCreateCategory:p,isLoading:b=!1}){return e.jsxs(o,{open:s,onOpenChange:a,children:[e.jsx(i,{asChild:!0,children:e.jsxs(H,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Nova Categoria"]})}),e.jsxs(c,{className:"bg-neutral-950 border-neutral-800 text-white",children:[e.jsxs(d,{children:[e.jsx(u,{children:"Criar Nova Categoria"}),e.jsx(x,{className:"text-neutral-400",children:"Digite o nome da nova categoria para adicionar ao dashboard."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsx(Y,{value:t,onChange:e=>r(e.target.value),className:"bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500",placeholder:"Nome da categoria",onKeyDown:e=>{"Enter"===e.key&&p()}}),e.jsx("textarea",{value:n,onChange:e=>l(e.target.value),className:"w-full bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500 rounded-md px-3 py-2 text-sm resize-none h-20 focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-transparent",placeholder:"Descrição da categoria",rows:3,required:!0})]}),e.jsxs(m,{children:[e.jsx(H,{onClick:()=>{a(!1),r(""),l("")},className:"border border-neutral-700 text-white hover:bg-neutral-800",disabled:b,children:"Cancelar"}),e.jsx(H,{onClick:p,className:"bg-green-600 hover:bg-green-700",disabled:!t.trim()||!n.trim()||b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 animate-spin"}),"Criando..."]}):"Criar Categoria"})]})]})]})}function pe({isOpen:s,onOpenChange:a,courseTitle:t,onCourseTitleChange:r,courseDescription:n,onCourseDescriptionChange:l,onCreateCourse:p,selectedCategoryId:b,categories:j,isLoading:f=!1}){const v=j.find(e=>e.id===b);return e.jsxs(o,{open:s,onOpenChange:a,children:[e.jsx(i,{asChild:!0,children:e.jsxs(H,{variant:"ghost",className:"border border-neutral-700 hover:bg-neutral-900",disabled:!b,children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Novo Curso"]})}),e.jsxs(c,{className:"bg-neutral-950 border-neutral-800 text-white",children:[e.jsxs(d,{children:[e.jsx(u,{children:"Criar Novo Curso"}),e.jsx(x,{className:"text-neutral-400",children:b?`Adicionando um novo curso à categoria: ${v?.name}`:"Selecione uma categoria primeiro para criar um curso."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsx(Y,{value:t,onChange:e=>r(e.target.value),className:"bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500",placeholder:"Título do curso",onKeyDown:e=>{"Enter"===e.key&&p()}}),e.jsx("textarea",{value:n,onChange:e=>l(e.target.value),className:"w-full bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500 rounded-md px-3 py-2 text-sm resize-none h-20 focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-transparent",placeholder:"Descrição do curso",rows:3,required:!0})]}),e.jsxs(m,{children:[e.jsx(H,{onClick:()=>{a(!1),r(""),l("")},className:"border border-neutral-700 text-white hover:bg-neutral-800",disabled:f,children:"Cancelar"}),e.jsx(H,{onClick:p,className:"bg-green-600 hover:bg-green-700",disabled:!t.trim()||!n.trim()||!b||f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 animate-spin"}),"Criando..."]}):"Criar Curso"})]})]})]})}function be({isOpen:s,onOpenChange:a,lessonTitle:t,onLessonTitleChange:r,lessonDuration:n,onLessonDurationChange:l,lessonDescription:p,onLessonDescriptionChange:b,onCreateLesson:j,selectedCategoryId:f,selectedCourseId:v,categories:N,isLoading:w=!1}){const y=N.find(e=>e.id===f),C=y?.courses.find(e=>e.id===v);return e.jsxs(o,{open:s,onOpenChange:a,children:[e.jsx(i,{asChild:!0,children:e.jsxs(H,{variant:"ghost",className:"border border-neutral-700 hover:bg-neutral-900",disabled:!v,children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Nova Aula"]})}),e.jsxs(c,{className:"bg-neutral-950 border-neutral-800 text-white",children:[e.jsxs(d,{children:[e.jsx(u,{children:"Criar Nova Aula"}),e.jsx(x,{className:"text-neutral-400",children:v?`Adicionando uma nova aula ao curso: ${C?.title}`:"Selecione um curso primeiro para criar uma aula."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsx(Y,{value:t,onChange:e=>r(e.target.value),className:"bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500",placeholder:"Título da aula"}),e.jsx(Y,{value:n,onChange:e=>l(e.target.value),className:"bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500",placeholder:"Duração (ex: 15:30)"}),e.jsx("textarea",{value:p,onChange:e=>b(e.target.value),className:"w-full bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500 rounded-md px-3 py-2 text-sm resize-none h-20 focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-transparent",placeholder:"Descrição da aula",rows:3,required:!0})]}),e.jsxs(m,{children:[e.jsx(H,{onClick:()=>{a(!1),r(""),l(""),b("")},className:"border border-neutral-700 text-white hover:bg-neutral-800",disabled:w,children:"Cancelar"}),e.jsx(H,{onClick:j,className:"bg-green-600 hover:bg-green-700",disabled:!t.trim()||!n.trim()||!p.trim()||!v||w,children:w?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 animate-spin"}),"Criando..."]}):"Criar Aula"})]})]})]})}var je="Checkbox",[fe]=l(je),[ve,Ne]=fe(je);function we(s){const{__scopeCheckbox:a,checked:r,children:n,defaultChecked:l,disabled:o,form:i,name:c,onCheckedChange:d,required:u,value:x="on",internal_do_not_use_render:m}=s,[h,g]=t({prop:r,defaultProp:l??!1,onChange:d,caller:je}),[b,j]=p.useState(null),[f,v]=p.useState(null),N=p.useRef(!1),w=!b||(!!i||!!b.closest("form")),y={checked:h,disabled:o,setChecked:g,control:b,setControl:j,name:c,form:i,value:x,hasConsumerStoppedPropagationRef:N,required:u,defaultChecked:!Ie(l)&&l,isFormControl:w,bubbleInput:f,setBubbleInput:v};return e.jsx(ve,{scope:a,...y,children:Te(m)?m(y):n})}var ye="CheckboxTrigger",Ce=p.forwardRef(({__scopeCheckbox:s,onKeyDown:t,onClick:l,...o},i)=>{const{control:c,value:d,disabled:u,checked:x,required:m,setControl:h,setChecked:g,hasConsumerStoppedPropagationRef:b,isFormControl:j,bubbleInput:f}=Ne(ye,s),v=r(i,h),N=p.useRef(x);return p.useEffect(()=>{const e=c?.form;if(e){const s=()=>g(N.current);return e.addEventListener("reset",s),()=>e.removeEventListener("reset",s)}},[c,g]),e.jsx(a.button,{type:"button",role:"checkbox","aria-checked":Ie(x)?"mixed":x,"aria-required":m,"data-state":Le(x),"data-disabled":u?"":void 0,disabled:u,value:d,...o,ref:v,onKeyDown:n(t,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:n(l,e=>{g(e=>!!Ie(e)||!e),f&&j&&(b.current=e.isPropagationStopped(),b.current||e.stopPropagation())})})});Ce.displayName=ye;var Se=p.forwardRef((s,a)=>{const{__scopeCheckbox:t,name:r,checked:n,defaultChecked:l,required:o,disabled:i,value:c,onCheckedChange:d,form:u,...x}=s;return e.jsx(we,{__scopeCheckbox:t,checked:n,defaultChecked:l,disabled:i,required:o,onCheckedChange:d,name:r,form:u,value:c,internal_do_not_use_render:({isFormControl:s})=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{...x,ref:a,__scopeCheckbox:t}),s&&e.jsx(De,{__scopeCheckbox:t})]})})});Se.displayName=je;var ke="CheckboxIndicator",Ee=p.forwardRef((t,r)=>{const{__scopeCheckbox:n,forceMount:l,...o}=t,i=Ne(ke,n);return e.jsx(s,{present:l||Ie(i.checked)||!0===i.checked,children:e.jsx(a.span,{"data-state":Le(i.checked),"data-disabled":i.disabled?"":void 0,...o,ref:r,style:{pointerEvents:"none",...t.style}})})});Ee.displayName=ke;var Oe="CheckboxBubbleInput",De=p.forwardRef(({__scopeCheckbox:s,...t},n)=>{const{control:l,hasConsumerStoppedPropagationRef:o,checked:i,defaultChecked:c,required:d,disabled:u,name:x,value:m,form:h,bubbleInput:g,setBubbleInput:b}=Ne(Oe,s),j=r(n,b),f=function(e){const s=p.useRef({value:e,previous:e});return p.useMemo(()=>(s.current.value!==e&&(s.current.previous=s.current.value,s.current.value=e),s.current.previous),[e])}(i),v=Z(l);p.useEffect(()=>{const e=g;if(!e)return;const s=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(s,"checked").set,t=!o.current;if(f!==i&&a){const s=new Event("click",{bubbles:t});e.indeterminate=Ie(i),a.call(e,!Ie(i)&&i),e.dispatchEvent(s)}},[g,f,i,o]);const N=p.useRef(!Ie(i)&&i);return e.jsx(a.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??N.current,required:d,disabled:u,name:x,value:m,form:h,...t,tabIndex:-1,ref:j,style:{...t.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function Te(e){return"function"==typeof e}function Ie(e){return"indeterminate"===e}function Le(e){return Ie(e)?"indeterminate":e?"checked":"unchecked"}function Ae({className:s,...a}){return e.jsx(Se,{"data-slot":"checkbox",className:K("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(Ee,{"data-slot":"checkbox-indicator",className:"grid place-content-center text-current transition-none",children:e.jsx(b,{className:"size-3.5"})})})}function ze({isOpen:s,onOpenChange:a,onVideoSelect:t,currentVideoUrl:r,videoPath:n}){const[l,i]=p.useState(null),[h,g]=p.useState(!1),[b,k]=p.useState(!1),[E,O]=p.useState(0),[D,T]=p.useState(null),[I,L]=p.useState(0),[A,z]=p.useState(0),[P,R]=p.useState(0),[U,_]=p.useState(!1),[$,q]=p.useState({isOpen:!1,title:"",message:"",isSuccess:!1}),M=p.useRef(null),B=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768&&"ontouchstart"in window;p.useEffect(()=>{let e;return b&&D&&(e=setInterval(()=>{const e=Math.floor((Date.now()-D)/1e3);L(e)},1e3)),()=>{e&&clearInterval(e)}},[b,D]),p.useEffect(()=>{},[$]),p.useEffect(()=>{s&&he().then(e=>{_(e)}).catch(e=>{_(!1)})},[s]);const F=e=>{e&&e.type.startsWith("video/")?i(e):alert("Por favor, selecione um arquivo de vídeo válido.")},J=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?g(!0):"dragleave"===e.type&&g(!1)},G=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]};return e.jsxs(o,{open:s,onOpenChange:a,children:[e.jsxs(c,{className:"bg-neutral-950 border-neutral-800 text-white max-w-2xl",children:[e.jsxs(d,{children:[e.jsx(u,{children:"Upload de Vídeo"}),e.jsx(x,{className:"text-neutral-400",children:"Selecione um arquivo de vídeo para esta aula."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative border-2 border-dashed rounded-xl p-10 text-center transition-all duration-300 "+(h?"border-green-400 bg-green-400/5 scale-[1.02] shadow-lg shadow-green-400/10":"border-neutral-700 hover:border-neutral-600 hover:bg-neutral-900/30"),onDragEnter:J,onDragLeave:J,onDragOver:J,onDrop:e=>{e.preventDefault(),e.stopPropagation(),g(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&F(e.dataTransfer.files[0])},children:[e.jsxs("div",{className:"flex flex-col items-center space-y-6",children:[e.jsx("div",{className:"p-4 rounded-full transition-all duration-300 "+(h?"bg-green-400/20":"bg-neutral-800"),children:e.jsx(j,{className:"h-10 w-10 transition-colors duration-300 "+(h?"text-green-400":"text-neutral-400")})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xl font-semibold text-white",children:"Arraste e solte o vídeo aqui"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"ou clique para selecionar da galeria"})]}),e.jsxs(H,{onClick:()=>M.current?.click(),className:"border border-green-600/50 text-green-400 hover:bg-green-600/10 hover:border-green-400 transition-all duration-300",children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Selecionar Vídeo"]})]}),e.jsx("input",{ref:M,type:"file",accept:"video/*",onChange:e=>{const s=e.target.files[0];s&&F(s)},className:"hidden"})]}),l&&e.jsxs("div",{className:"bg-neutral-900/50 rounded-xl p-6 border border-neutral-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-green-400/10 rounded-lg",children:e.jsx(f,{className:"h-8 w-8 text-green-400"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-white truncate max-w-xs",children:l.name}),e.jsxs("p",{className:"text-xs text-neutral-400 flex items-center gap-2",children:[e.jsx(v,{className:"h-3 w-3"}),G(l.size)]})]})]}),!b&&e.jsx(H,{variant:"ghost",size:"sm",onClick:()=>i(null),className:"text-red-400 hover:text-red-300 hover:bg-red-900/20 transition-colors duration-200",children:e.jsx(N,{className:"h-4 w-4"})})]}),b&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin",children:e.jsx(j,{className:"h-4 w-4 text-green-400"})}),e.jsx("span",{className:"text-sm font-medium text-green-400",children:"Fazendo upload..."})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-sm font-semibold text-green-400",children:[E,"%"]}),e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-neutral-500",children:[e.jsx(w,{className:"h-3 w-3"}),e.jsx("span",{children:(e=>{const s=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`})(I)})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{value:E,className:"h-3 bg-neutral-800"}),e.jsx("div",{className:"h-1 bg-neutral-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-linear-to-r from-green-400 to-green-600 rounded-full transition-all duration-300 ease-out",style:{width:`${E}%`}})})]}),P>1&&e.jsxs("div",{className:"bg-linear-to-r from-green-400/5 to-green-600/5 border border-green-600/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-green-400/10 rounded-lg",children:e.jsx(y,{className:"h-4 w-4 text-green-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-green-400",children:"Upload em Partes"}),e.jsx("p",{className:"text-xs text-neutral-400",children:"Arquivo grande dividido para melhor performance"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-neutral-800/50 rounded-lg",children:[e.jsx("span",{className:"text-neutral-400",children:"Parte atual"}),e.jsxs("span",{className:"font-semibold text-green-400",children:[A," de ",P]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-neutral-800/50 rounded-lg",children:[e.jsx("span",{className:"text-neutral-400",children:"Tamanho total"}),e.jsx("span",{className:"font-semibold text-white",children:G(l.size)})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-neutral-800/50 rounded-lg",children:[e.jsx("span",{className:"text-neutral-400",children:"Tamanho da parte"}),e.jsx("span",{className:"font-semibold text-white",children:B()?"10MB":"50MB"})]})]})]})]}),!b&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"bg-black rounded-lg overflow-hidden border border-neutral-800",children:e.jsx("video",{src:URL.createObjectURL(l),className:"w-full",controls:!0,style:{maxHeight:"200px"}})})})]}),r&&!l&&e.jsxs("div",{className:"bg-neutral-900/50 rounded-xl p-6 border border-neutral-800",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(f,{className:"h-4 w-4 text-neutral-400"}),e.jsx("p",{className:"text-sm font-medium text-neutral-400",children:"Vídeo atual:"})]}),e.jsx("div",{className:"bg-black rounded-lg overflow-hidden border border-neutral-800",children:e.jsx("video",{src:r,className:"w-full",controls:!0,style:{maxHeight:"200px"}})})]})]}),e.jsxs(m,{className:"gap-3",children:[e.jsx(H,{onClick:()=>{i(null),a(!1)},className:"border border-neutral-700 text-white hover:bg-neutral-800 transition-colors duration-200",children:"Cancelar"}),e.jsx(H,{onClick:async()=>{if(l)try{k(!0),O(0),T(Date.now()),L(0);const e=B()?10485760:52428800,s=Math.ceil(l.size/e);R(s),z(0);const r=await me(l,e=>{O(e);const a=Math.min(Math.floor(e/100*s),s-1);z(a+1)},n),o=r&&(200===r.StatusCode||200===r.status);if(q({isOpen:!0,title:o?"Resposta do Servidor":"Erro no Upload",message:o?r?.StatusMessage||r?.message||"Upload processado com sucesso":r?.StatusMessage||r?.message||r?.error||"Ocorreu um erro ao fazer upload do vídeo. Tente novamente.",isSuccess:o}),o){const e=r?.Result?.url||r?.url||URL.createObjectURL(l);t({file:l,url:e,name:l.name,size:l.size,type:l.type}),setTimeout(()=>{i(null),O(0),T(null),L(0),z(0),R(0),a(!1)},2e3)}else O(0),T(null),L(0),z(0),R(0)}finally{k(!1)}},className:"font-medium transition-all duration-200 "+(U?"bg-neutral-700 hover:bg-neutral-600 text-neutral-300 cursor-not-allowed border border-neutral-600":"bg-linear-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white shadow-lg shadow-green-600/25"),disabled:!l||b||U,children:b?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin",children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx("span",{children:"Enviando..."})]}):U?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-pulse",children:e.jsx(w,{className:"h-4 w-4"})}),e.jsx("span",{children:"Processando"})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx("span",{children:"Fazer Upload"})]})})]})]}),e.jsx(o,{open:$.isOpen,onOpenChange:e=>q(s=>({...s,isOpen:e})),children:e.jsxs(c,{className:"bg-neutral-950 border-neutral-800 text-white max-w-md",children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full transition-all duration-300 "+($.isSuccess?"bg-green-400/20 text-green-400 shadow-lg shadow-green-400/25":"bg-red-400/20 text-red-400 shadow-lg shadow-red-400/25"),children:$.isSuccess?e.jsx(C,{className:"h-6 w-6"}):e.jsx(S,{className:"h-6 w-6"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-lg font-semibold "+($.isSuccess?"text-green-400":"text-red-400"),children:$.title}),e.jsx("p",{className:"text-sm text-neutral-400",children:$.isSuccess?"Operação concluída com sucesso":"Ocorreu um erro inesperado"})]})]})}),e.jsx("div",{className:"py-2",children:e.jsx(x,{className:"text-neutral-300 leading-relaxed",children:$.message})}),e.jsx(m,{className:"gap-2",children:e.jsx(H,{onClick:()=>q(e=>({...e,isOpen:!1})),className:"font-medium transition-all duration-200 "+($.isSuccess?"bg-linear-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white shadow-lg shadow-green-600/25":"bg-linear-to-r from-red-600 to-red-500 hover:from-red-500 hover:to-red-400 text-white shadow-lg shadow-red-600/25"),children:$.isSuccess?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx("span",{children:"OK"})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx("span",{children:"Fechar"})]})})})]})})]})}function Pe({isOpen:s,onOpenChange:a,lesson:t,onSaveLesson:r,categories:n,isLoading:l=!1}){const[i,h]=p.useState(""),[b,f]=p.useState(""),[v,N]=p.useState(""),[w,y]=p.useState(""),[C,S]=p.useState(!1),[k,E]=p.useState(!1);p.useEffect(()=>{t&&(h(t.title||""),f(t.duration||""),N(t.description||""),y(t.videoUrl||""),S(t.isPaid||!1))},[t]);return e.jsxs(e.Fragment,{children:[e.jsx(o,{open:s,onOpenChange:a,children:e.jsxs(c,{className:"bg-neutral-950 border-neutral-800 text-white",children:[e.jsxs(d,{children:[e.jsx(u,{children:"Editar Aula"}),e.jsx(x,{className:"text-neutral-400",children:"Modifique as informações da aula."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-white mb-2 block",children:"Título da Aula"}),e.jsx(Y,{value:i,onChange:e=>h(e.target.value),className:"bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500",placeholder:"Título da aula"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-white mb-2 block",children:"Duração"}),e.jsx(Y,{value:b,onChange:e=>f(e.target.value),className:"bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500",placeholder:"Duração (ex: 15:30)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-white mb-2 block",children:"Descrição"}),e.jsx("textarea",{value:v,onChange:e=>N(e.target.value),className:"w-full bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500 rounded-md px-3 py-2 text-sm resize-none h-20 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent",placeholder:"Descrição da aula",rows:3,required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ae,{id:"isPaid",checked:C,onCheckedChange:S,className:"bg-neutral-900 border-neutral-700 data-[state=checked]:bg-green-600 data-[state=checked]:border-green-600"}),e.jsx("label",{htmlFor:"isPaid",className:"text-sm font-medium text-white cursor-pointer",children:"Aula Paga (Bloqueada)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-white mb-2 block",children:"Vídeo da Aula"}),e.jsxs("div",{className:"space-y-3",children:[w&&e.jsx("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:e.jsx("video",{src:w,className:"w-full rounded-lg bg-black",controls:!0,style:{maxHeight:"150px"}})}),e.jsxs(H,{onClick:()=>E(!0),className:"w-full border border-neutral-700 text-white hover:bg-neutral-800",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),w?"Trocar Vídeo":"Upload de Vídeo"]})]})]})]}),e.jsxs(m,{children:[e.jsx(H,{onClick:()=>a(!1),className:"border border-neutral-700 text-white hover:bg-neutral-800",disabled:l,children:"Cancelar"}),e.jsx(H,{onClick:async()=>{if(i.trim()&&b.trim()&&v.trim())try{await r({...t,title:i.trim(),duration:b.trim(),description:v.trim(),videoUrl:w,isPaid:C}),a(!1)}catch{}},className:"bg-green-600 hover:bg-green-700",disabled:!i.trim()||!b.trim()||!v.trim()||l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 animate-spin"}),"Salvando..."]}):"Salvar Alterações"})]})]})}),e.jsx(ze,{isOpen:k,onOpenChange:E,onVideoSelect:e=>{y(e.url)},currentVideoUrl:w,videoPath:t&&t.id?`l${t.id}`:null})]})}function Re({lesson:s,onEditLesson:a}){return e.jsx(H,{variant:"ghost",size:"sm",className:"text-neutral-400 hover:text-white hover:bg-neutral-700",onClick:e=>{e.stopPropagation(),a(s)},children:e.jsx(k,{className:"h-3 w-3"})})}function Ue({lesson:s,onEditLesson:a}){return e.jsxs(H,{variant:"ghost",size:"sm",className:"border border-neutral-700 hover:bg-neutral-900",onClick:()=>a(s),children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Editar Aula"]})}function _e({category:s,isExpanded:a,onToggle:t,onSelect:r,isSelected:n,expandedCourses:l,onCourseToggle:o,onCourseSelect:i,onLessonSelect:c,selected:d,onEditLesson:u,onDeleteCategory:x,onDeleteCourse:m,onDeleteLesson:h,onEditCategory:p,onEditCourse:b,loadingCourses:j={},loadingLessons:f={}}){return e.jsxs("div",{className:"rounded-xl border border-neutral-800 bg-neutral-900/30",children:[e.jsxs("button",{type:"button",className:"w-full flex items-center justify-between gap-3 px-3 py-3 hover:bg-neutral-800/30 transition-colors rounded-xl "+(n?"bg-neutral-800/50":""),onClick:()=>{t(s.id),r({type:"category",categoryId:s.id,courseId:null,lessonId:null})},children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-green-600/15 border border-green-500/20 shrink-0",children:e.jsx(E,{className:"h-4 w-4 text-green-400"})}),e.jsxs("div",{className:"min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-semibold text-white truncate",children:s.name}),a&&e.jsxs("div",{className:"text-xs text-neutral-400",children:[s.courses.length," curso",1!==s.courses.length?"s":""]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(H,{variant:"ghost",size:"sm",className:"text-neutral-400 hover:text-white hover:bg-neutral-700",onClick:e=>{e.stopPropagation(),p(s)},children:e.jsx(k,{className:"h-4 w-4"})}),e.jsx(H,{variant:"ghost",size:"sm",className:"text-red-400 hover:text-red-300 hover:bg-red-900/20",onClick:e=>{e.stopPropagation(),x(s.id)},children:e.jsx(O,{className:"h-4 w-4"})}),a?e.jsx(D,{className:"h-4 w-4 text-neutral-400"}):e.jsx(T,{className:"h-4 w-4 text-neutral-400"})]})]}),a&&e.jsx("div",{className:"px-3 pb-3 space-y-2 mt-2",children:j[s.id]?e.jsxs("div",{className:"flex items-center gap-2 py-3 px-3 rounded-lg bg-neutral-800/30 text-sm text-neutral-400",children:[e.jsx(g,{className:"h-4 w-4 animate-spin shrink-0"}),"Carregando cursos..."]}):e.jsx(e.Fragment,{children:0===s.courses.length?e.jsx("div",{className:"py-3 px-3 rounded-lg bg-neutral-900/40 border border-dashed border-neutral-700 text-xs text-neutral-400",children:"Nenhum curso cadastrado nesta categoria ainda."}):s.courses.map(a=>e.jsx($e,{course:a,category:s,isExpanded:l.has(a.id),onToggle:o,onSelect:i,isSelected:"course"===d.type&&d.courseId===a.id,onLessonSelect:c,selected:d,onEditLesson:u,onDeleteCourse:m,onDeleteLesson:h,onEditCourse:b,loadingLessons:f},a.id))})})]})}function $e({course:s,category:a,isExpanded:t,onToggle:r,onSelect:n,isSelected:l,onLessonSelect:o,selected:i,onEditLesson:c,onDeleteCourse:d,onDeleteLesson:u,onEditCourse:x,loadingLessons:m={}}){return e.jsxs("div",{className:"rounded-lg border border-neutral-800 bg-neutral-950/40",children:[e.jsxs("button",{type:"button",className:"w-full flex items-center justify-between gap-3 px-3 py-2 hover:bg-neutral-800/30 transition-colors rounded-lg "+(l?"bg-neutral-800/50":""),onClick:()=>{r(s.id),n({type:"course",categoryId:a.id,courseId:s.id,lessonId:null})},children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(I,{className:"h-4 w-4 text-emerald-400 shrink-0"}),e.jsxs("div",{className:"min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate",children:s.title}),t&&e.jsxs("div",{className:"text-xs text-neutral-400",children:[s.lessons?.length||0," aula",1!==(s.lessons?.length||0)?"s":""]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(H,{variant:"ghost",size:"sm",className:"text-neutral-400 hover:text-white hover:bg-neutral-700",onClick:e=>{e.stopPropagation(),x(a.id,s)},children:e.jsx(k,{className:"h-3 w-3"})}),e.jsx(H,{variant:"ghost",size:"sm",className:"text-red-400 hover:text-red-300 hover:bg-red-900/20",onClick:e=>{e.stopPropagation(),d(a.id,s.id)},children:e.jsx(O,{className:"h-3 w-3"})}),t?e.jsx(D,{className:"h-4 w-4 text-neutral-400"}):e.jsx(T,{className:"h-4 w-4 text-neutral-400"})]})]}),t&&e.jsx("div",{className:"px-3 pb-3 space-y-2 mt-2",children:m[s.id]?e.jsxs("div",{className:"flex items-center gap-2 py-2 px-3 rounded-lg bg-neutral-800/20 text-sm text-neutral-400",children:[e.jsx(g,{className:"h-3 w-3 animate-spin shrink-0"}),"Carregando aulas..."]}):e.jsx(e.Fragment,{children:0===(s.lessons||[]).length?e.jsx("div",{className:"py-2 px-3 rounded-lg bg-neutral-900/40 border border-dashed border-neutral-700 text-xs text-neutral-400",children:"Nenhuma aula cadastrada neste curso ainda."}):(s.lessons||[]).map(t=>e.jsx(qe,{lesson:t,onSelect:o,isSelected:"lesson"===i.type&&i.lessonId===t.id,category:a,course:s,onEditLesson:c,onDeleteLesson:u},t.id))})})]})}function qe({lesson:s,onSelect:a,isSelected:t,category:r,course:n,onEditLesson:l,onDeleteLesson:o}){return e.jsxs("button",{type:"button",className:"w-full flex items-center justify-between gap-3 px-3 py-2 rounded-lg bg-neutral-800/20 hover:bg-neutral-800/40 transition-colors "+(t?"bg-neutral-800/50":""),onClick:()=>a({type:"lesson",categoryId:r.id,courseId:n.id,lessonId:s.id}),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 text-left",children:[e.jsx(L,{className:"h-3 w-3 text-neutral-300 shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate",children:s.title}),e.jsx("div",{className:"text-xs text-neutral-400",children:s.duration})]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(Re,{lesson:s,onEditLesson:l}),e.jsx(H,{variant:"ghost",size:"sm",className:"text-red-400 hover:text-red-300 hover:bg-red-900/20",onClick:e=>{e.stopPropagation(),o(r.id,n.id,s.id)},children:e.jsx(O,{className:"h-3 w-3"})})]})]},s.id)}function Me({selectedData:s,selected:a,onEditLesson:t,onDeleteCategory:r,onDeleteCourse:n,onDeleteLesson:l,onEditCategory:o,onEditCourse:i,lessonDialogProps:c}){return e.jsxs("div",{className:"rounded-xl border border-neutral-800 bg-neutral-900/40 p-4 space-y-4",children:[!s.category&&e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-dashed border-neutral-700 bg-neutral-950/40 px-3 py-3 text-xs text-neutral-400",children:[e.jsx(E,{className:"h-4 w-4 text-neutral-500 shrink-0"}),e.jsx("span",{children:"Selecione uma categoria, curso ou aula na árvore ao lado."})]}),s.category&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 flex h-7 w-7 items-center justify-center rounded-md bg-green-600/15 border border-green-500/30 shrink-0",children:e.jsx(E,{className:"h-4 w-4 text-green-400"})}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-[11px] font-medium uppercase tracking-wide text-green-400/80",children:"Categoria"}),e.jsx("div",{className:"text-sm sm:text-base font-semibold text-white truncate",children:s.category.name}),e.jsxs("div",{className:"mt-1 text-xs text-neutral-400",children:[s.category.courses.length," curso",1!==s.category.courses.length?"s":""]})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(H,{variant:"ghost",size:"icon",className:"h-8 w-8 text-neutral-300 hover:text-white hover:bg-neutral-800/80 border border-neutral-700/70",onClick:()=>{o(s.category)},children:e.jsx(k,{className:"h-3.5 w-3.5"})}),e.jsx(H,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-400 hover:text-red-300 hover:bg-red-900/30 border border-red-600/40",onClick:()=>{r(s.category.id)},children:e.jsx(O,{className:"h-3.5 w-3.5"})})]})]})})]}),s.course&&e.jsxs("div",{className:"ml-3 pl-4 border-l border-dashed border-neutral-800/80 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 flex h-7 w-7 items-center justify-center rounded-md bg-emerald-500/10 border border-emerald-500/30 shrink-0",children:e.jsx(I,{className:"h-4 w-4 text-emerald-300"})}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-[11px] font-medium uppercase tracking-wide text-emerald-300/80",children:"Curso"}),e.jsx("div",{className:"text-sm sm:text-base font-semibold text-white",children:s.course.title}),e.jsxs("div",{className:"mt-1 text-xs text-neutral-400",children:[s.course.lessons.length," aula",1!==s.course.lessons.length?"s":""]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1 shrink-0",children:[e.jsx(H,{variant:"ghost",size:"icon",className:"h-8 w-8 text-neutral-300 hover:text-white hover:bg-neutral-800/80 border border-neutral-700/70",onClick:()=>{i(a.categoryId,s.course)},children:e.jsx(k,{className:"h-3.5 w-3.5"})}),e.jsx(be,{...c}),e.jsx(H,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-400 hover:text-red-300 hover:bg-red-900/30 border border-red-600/40",onClick:()=>{n(a.categoryId,s.course.id)},children:e.jsx(O,{className:"h-3.5 w-3.5"})})]})]})})]}),s.lesson&&e.jsx("div",{className:"ml-3 pl-4 border-l border-dashed border-neutral-800/80",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 flex h-7 w-7 items-center justify-center rounded-md bg-neutral-500/10 border border-neutral-500/40 shrink-0",children:e.jsx(L,{className:"h-4 w-4 text-neutral-200"})}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-[11px] font-medium uppercase tracking-wide text-neutral-300/80",children:"Aula"}),e.jsx("div",{className:"text-sm sm:text-base font-semibold text-white",children:s.lesson.title}),e.jsxs("div",{className:"mt-1 text-xs text-neutral-400",children:["Duração: ",s.lesson.duration]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1 shrink-0",children:[e.jsx(Ue,{lesson:s.lesson,onEditLesson:t}),e.jsx(H,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-400 hover:text-red-300 hover:bg-red-900/30 border border-red-600/40",onClick:()=>{l(a.categoryId,a.courseId,s.lesson.id)},children:e.jsx(O,{className:"h-3.5 w-3.5"})})]})]})})]})})]})]})]})}function Be({query:s,onQueryChange:a,categoryDialogProps:t,courseDialogProps:r,lessonDialogProps:n}){return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Y,{value:s,onChange:e=>a(e.target.value),className:"bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500",placeholder:"Buscar categoria, curso ou aula..."})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(ge,{...t}),e.jsx(pe,{...r}),e.jsx(be,{...n})]})]})}De.displayName=Oe;const Fe={async getUsers(){try{const e=q(),s=await fetch($.USERS,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Erro na requisição: ${s.status}`);return await s.json()}catch(e){throw e}},async updateUserName(e,s){try{const a=q(),t=await fetch(`${$.USERS}/update-name`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({userId:e,name:s})});if(!t.ok)throw new Error(`Erro na requisição: ${t.status}`);return await t.json()}catch(a){throw a}},async updateUserEmail(e,s){try{const a=q(),t=await fetch(`${$.USERS}/update-email`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({userId:e,email:s})});if(!t.ok)throw new Error(`Erro na requisição: ${t.status}`);return await t.json()}catch(a){throw a}},async updateUserStatus(e,s){try{const a=q(),t=await fetch(`${$.USERS}/update-status`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({userId:e,status:s})});if(!t.ok)throw new Error(`Erro na requisição: ${t.status}`);return await t.json()}catch(a){throw a}},async updateUserRole(e,s){try{const a=q(),t=await fetch(`${$.USERS}/update-role`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({userId:e,isAdmin:s})});if(!t.ok)throw new Error(`Erro na requisição: ${t.status}`);return await t.json()}catch(a){throw a}},async deleteUser(e){try{const s=q(),a=await fetch(`${$.USERS}/delete`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({userId:e})});if(!a.ok)throw new Error(`Erro na requisição: ${a.status}`);return await a.json()}catch(s){throw s}}},Je={ativo:"Ativo",analise:"Em análise",banido:"Banido"},Ge={aluno:"Aluno",admin:"Administrador"};function Ve(){const[s,a]=p.useState(""),[t,r]=p.useState("todos"),[n,l]=p.useState([]),[o,i]=p.useState(!0),[c,d]=p.useState(null),[u,x]=p.useState({show:!1,message:"",variant:"default"}),m=(e,s="default")=>{x({show:!0,message:e,variant:s}),setTimeout(()=>{x({show:!1,message:"",variant:"default"})},5e3)},h=e=>{l(s=>s.map(s=>s.id===e.id?e:s))},g=async e=>{try{const s=await Fe.deleteUser(e);200===s.StatusCode?(l(s=>s.filter(s=>s.id!==e)),m("Usuário excluído com sucesso","default")):m(s.StatusMessage||"Erro ao excluir usuário","destructive")}catch(s){m("Erro ao conectar com o servidor","destructive")}};p.useEffect(()=>{(async()=>{try{i(!0);const e=await Fe.getUsers();if(200===e.StatusCode){const s=e.Result.map(e=>({id:e.id.toString(),name:e.fullname,email:e.email,role:e.isadmin?"admin":"aluno",status:e.banned?"banido":"ativo",lastAccess:e.last_access?b(e.last_access):"Nunca"}));l(s)}else m(e.StatusMessage||"Erro ao carregar usuários","destructive"),d(e.StatusMessage||"Erro ao carregar usuários")}catch(e){m("Não foi possível carregar os usuários","destructive"),d("Não foi possível carregar os usuários")}finally{i(!1)}})()},[]);const b=e=>{try{const s=new Date(e),a=new Date-s,t=Math.floor(a/36e5),r=Math.floor(t/24);return t<1?"Agora mesmo":t<24?`Há ${t} horas`:1===r?"Ontem":r<30?`Há ${r} dias`:r<365?`Há ${Math.floor(r/30)} meses`:`Há ${Math.floor(r/365)} anos`}catch{return"Data inválida"}},j=p.useMemo(()=>{const e=s.trim().toLowerCase();return n.filter(s=>("todos"===t||s.status===t)&&(!e||(s.name.toLowerCase().includes(e)||s.email.toLowerCase().includes(e)||s.id.toLowerCase().includes(e))))},[s,t,n]),f=n.length,v=n.filter(e=>"ativo"===e.status).length;return n.filter(e=>"analise"===e.status).length,o?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-400",children:"Carregando usuários..."})]})})}):c?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-400 mb-4",children:e.jsx(A,{className:"h-8 w-8 mx-auto"})}),e.jsx("p",{className:"text-red-400 mb-2",children:c}),e.jsx("button",{onClick:()=>window.location.reload(),className:"text-green-400 hover:text-green-300 text-sm underline",children:"Tentar novamente"})]})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-white",children:"Usuários da plataforma"}),e.jsx("p",{className:"text-xs sm:text-sm text-neutral-400 max-w-xl",children:"Visão geral dos alunos e administradores da Ring0X. Use os filtros abaixo para encontrar rapidamente quem você precisa."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs sm:text-sm",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-lg bg-neutral-900/70 border border-neutral-800 px-3 py-2",children:[e.jsx(z,{className:"h-3.5 w-3.5 text-green-400"}),e.jsxs("span",{className:"text-neutral-300",children:[e.jsx("span",{className:"font-semibold text-white",children:v})," ","ativos"]})]}),e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-lg bg-neutral-900/70 border border-neutral-800 px-3 py-2",children:[e.jsx(P,{className:"h-3.5 w-3.5 text-neutral-300"}),e.jsxs("span",{className:"text-neutral-300",children:[e.jsx("span",{className:"font-semibold text-white",children:f})," no total"]})]})]})]}),u.show&&e.jsx(M,{variant:u.variant,className:"mt-4",children:e.jsx(B,{children:u.message})}),e.jsxs(F,{className:"bg-neutral-950 border-neutral-800 text-white shadow-2xl",children:[e.jsxs(J,{className:"pb-3 space-y-3",children:[e.jsx(G,{className:"text-base sm:text-lg font-semibold",children:"Gestão de usuários"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Y,{value:s,onChange:e=>a(e.target.value),className:"bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500 h-9 sm:h-10 w-full",placeholder:"Buscar por nome, email ou ID..."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(He,{label:"Todos",isActive:"todos"===t,onClick:()=>r("todos")}),e.jsx(He,{label:"Ativos",isActive:"ativo"===t,onClick:()=>r("ativo")}),e.jsx(He,{label:"Em análise",isActive:"analise"===t,onClick:()=>r("analise")}),e.jsx(He,{label:"Banidos",isActive:"banido"===t,onClick:()=>r("banido")})]})]})]}),e.jsx(V,{className:"pt-0",children:e.jsxs("div",{className:"rounded-xl border border-neutral-800 bg-neutral-900/40 overflow-hidden",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-3 px-4 py-3 text-xs font-medium text-neutral-400 border-b border-neutral-800 bg-neutral-900/70",children:[e.jsx("span",{className:"col-span-4",children:"Usuário"}),e.jsx("span",{className:"col-span-3",children:"Contato"}),e.jsx("span",{className:"col-span-2",children:"Perfil"}),e.jsx("span",{className:"col-span-2",children:"Status"}),e.jsx("span",{className:"col-span-1 text-right",children:"Último acesso"})]}),e.jsx(W,{className:"h-[400px] sm:h-[430px]",children:e.jsx("div",{className:"divide-y divide-neutral-800/80",children:0===j.length?e.jsx("div",{className:"px-4 py-10 text-center text-sm text-neutral-400",children:"Nenhum usuário encontrado com os filtros atuais."}):j.map(s=>e.jsx(Ke,{user:s,onUpdate:h,onDelete:g,showAlert:m},s.id))})})]})})]})]})}function He({label:s,isActive:a,onClick:t}){return e.jsx(H,{type:"button",variant:"ghost",size:"sm",onClick:t,className:"h-8 rounded-full border text-xs px-3 transition-colors "+(a?"border-green-500 bg-green-600/20 text-green-300":"border-neutral-700 bg-neutral-900/60 text-neutral-300 hover:bg-neutral-800/80"),children:s})}function Ke({user:s,onUpdate:a,onDelete:t,showAlert:r}){const n="admin"===s.role,[l,o]=p.useState(null),[i,c]=p.useState({name:s.name,email:s.email,status:s.status,role:s.role}),[d,u]=p.useState(!1),[x,m]=p.useState(!1),[h,g]=p.useState(!1);p.useEffect(()=>{c({name:s.name,email:s.email,status:s.status,role:s.role}),o(null),u(!1),m(!1)},[s]);const j=e=>{o(e)},f=()=>{o(null),u(!1),m(!1),c({name:s.name,email:s.email,status:s.status,role:s.role})},v=async()=>{g(!0);try{await t(s.id),m(!1)}catch(e){}finally{g(!1)}},w=async e=>{g(!0);try{let t,n;switch(e){case"name":t=Fe.updateUserName,n=i.name;break;case"email":t=Fe.updateUserEmail,n=i.email;break;case"status":t=Fe.updateUserStatus,n=i.status;break;case"role":t=Fe.updateUserRole,n="admin"===i.role;break;default:return}const l=await t(s.id,n);if(200===l.StatusCode){const t={...s};"name"===e&&(t.name=i.name),"email"===e&&(t.email=i.email),"status"===e&&(t.status=i.status),"role"===e&&(t.role=i.role),a(t),o(null),u(!1);r(`${{name:"Nome",email:"E-mail",status:"Status",role:"Perfil"}[e]} atualizado com sucesso`,"default")}else r(l.StatusMessage||`Erro ao atualizar ${e}`,"destructive")}catch(t){r("Erro ao conectar com o servidor","destructive")}finally{g(!1)}},y=p.useCallback(()=>{const e="ativo"===s.status?"banido":"ativo";c(s=>({...s,status:e})),C(e)},[s.status]),C=p.useCallback(async e=>{g(!0);try{const t=await Fe.updateUserStatus(s.id,e);if(200===t.StatusCode){const t={...s,status:e};a(t),r("Status atualizado com sucesso","default")}else c(e=>({...e,status:s.status})),r(t.StatusMessage||"Erro ao atualizar status","destructive")}catch(t){c(e=>({...e,status:s.status})),r("Erro ao conectar com o servidor","destructive")}finally{g(!1)}},[s.id,s.status,a,r]),S=p.useCallback(()=>{"aluno"===s.role?u(!0):(c(e=>({...e,role:"aluno"})),E("aluno"))},[s.role]),k=p.useCallback(()=>{c(e=>({...e,role:"admin"})),E("admin")},[]),E=p.useCallback(async e=>{g(!0);try{const t="admin"===e,n=await Fe.updateUserRole(s.id,t);if(200===n.StatusCode){const t={...s,role:e};a(t),u(!1),r("Perfil atualizado com sucesso","default")}else c(e=>({...e,role:s.role})),u(!1),r(n.StatusMessage||"Erro ao atualizar perfil","destructive")}catch(t){c(e=>({...e,role:s.role})),u(!1),r("Erro ao conectar com o servidor","destructive")}finally{g(!1)}},[s.id,s.role,a,r]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-3 space-y-3 md:hidden",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(H,{size:"sm",onClick:()=>m(!0),className:"h-8 w-8 p-0 bg-red-600/10 border border-red-500/40 text-red-400 hover:bg-red-600/20 shrink-0",title:"Excluir usuário",children:e.jsx(O,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-lg bg-neutral-800 border border-neutral-700 shrink-0",children:e.jsx(P,{className:"h-4 w-4 text-neutral-200"})}),e.jsx("div",{className:"space-y-0.5 min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(X,{className:"bg-neutral-800/50 border border-neutral-700 text-neutral-400 text-[10px] font-mono",children:["ID: ",s.id]}),"name"===l?e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(Y,{value:i.name,onChange:e=>c({...i,name:e.target.value}),className:"bg-neutral-800 border-neutral-600 text-white text-sm h-7",disabled:h,autoFocus:!0}),e.jsx(H,{size:"sm",onClick:()=>w("name"),disabled:h,className:"h-7 w-7 p-0 bg-green-600 hover:bg-green-500",children:e.jsx(b,{className:"h-3 w-3"})}),e.jsx(H,{size:"sm",onClick:f,disabled:h,className:"h-7 w-7 p-0 bg-neutral-600 hover:bg-neutral-500",children:e.jsx(N,{className:"h-3 w-3"})})]}):e.jsx("span",{className:"text-sm font-semibold text-white truncate cursor-pointer hover:bg-neutral-800 px-2 py-1 rounded",onDoubleClick:()=>j("name"),children:s.name}),n&&e.jsx(X,{className:"bg-emerald-600/20 border border-emerald-500/40 text-emerald-200 text-[10px] uppercase tracking-wide",children:"Admin"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-neutral-300",children:[e.jsx(R,{className:"h-3.5 w-3.5 text-neutral-400 shrink-0"}),"email"===l?e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(Y,{value:i.email,onChange:e=>c({...i,email:e.target.value}),className:"bg-neutral-800 border-neutral-600 text-white text-xs h-7",disabled:h,autoFocus:!0}),e.jsx(H,{size:"sm",onClick:()=>w("email"),disabled:h,className:"h-7 w-7 p-0 bg-green-600 hover:bg-green-500",children:e.jsx(b,{className:"h-3 w-3"})}),e.jsx(H,{size:"sm",onClick:f,disabled:h,className:"h-7 w-7 p-0 bg-neutral-600 hover:bg-neutral-500",children:e.jsx(N,{className:"h-3 w-3"})})]}):e.jsx("span",{className:"truncate cursor-pointer hover:bg-neutral-800 px-2 py-1 rounded flex-1",onDoubleClick:()=>j("email"),children:s.email})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(X,{className:"bg-neutral-800 border border-neutral-700 text-neutral-200 text-[11px] cursor-pointer hover:bg-neutral-700",onClick:S,children:Ge[i.role]||i.role}),"ativo"===i.status&&e.jsxs(X,{className:"bg-emerald-600/15 border border-emerald-500/40 text-emerald-200 text-[11px] inline-flex items-center gap-1 cursor-pointer hover:bg-emerald-600/25",onClick:y,children:[e.jsx(U,{className:"h-3 w-3"}),Je[i.status]]}),"analise"===i.status&&e.jsxs(X,{className:"bg-amber-500/10 border border-amber-400/40 text-amber-200 text-[11px] inline-flex items-center gap-1 cursor-pointer hover:bg-amber-500/20",onClick:y,children:[e.jsx(z,{className:"h-3 w-3"}),Je[i.status]]}),"banido"===i.status&&e.jsxs(X,{className:"bg-red-600/10 border border-red-500/40 text-red-200 text-[11px] inline-flex items-center gap-1 cursor-pointer hover:bg-red-600/20",onClick:y,children:[e.jsx(A,{className:"h-3 w-3"}),Je[i.status]]})]}),e.jsxs("div",{className:"text-xs text-neutral-400",children:["Último acesso: ",s.lastAccess]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg p-4 max-w-sm w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(_,{className:"h-5 w-5 text-amber-400"}),e.jsx("h3",{className:"text-white font-semibold",children:"Confirmar mudança de perfil"})]}),e.jsx("p",{className:"text-neutral-300 text-sm mb-4",children:"Tem certeza que deseja promover este usuário para Administrador? Esta ação concederá acesso completo ao painel administrativo."}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(H,{onClick:()=>u(!1),className:"bg-neutral-700 hover:bg-neutral-600",children:"Cancelar"}),e.jsx(H,{onClick:k,className:"bg-green-600 hover:bg-green-500",disabled:h,children:h?"Salvando...":"Confirmar"})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg p-4 max-w-sm w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(O,{className:"h-5 w-5 text-red-400"}),e.jsx("h3",{className:"text-white font-semibold",children:"Confirmar exclusão"})]}),e.jsxs("p",{className:"text-neutral-300 text-sm mb-2",children:["Tem certeza que deseja excluir o usuário"," ",e.jsx("span",{className:"text-white font-semibold",children:s.name}),"?"]}),e.jsxs("p",{className:"text-neutral-400 text-xs mb-4",children:["ID: ",s.id," • ",s.email]}),e.jsx("p",{className:"text-red-400 text-sm mb-4",children:"⚠️ Esta ação não pode ser desfeita. Todos os dados do usuário serão permanentemente removidos."}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(H,{onClick:()=>m(!1),className:"bg-neutral-700 hover:bg-neutral-600",disabled:h,children:"Cancelar"}),e.jsx(H,{onClick:v,className:"bg-red-600 hover:bg-red-500",disabled:h,children:h?"Excluindo...":"Excluir"})]})]})})]})]}),e.jsxs("div",{className:"px-4 py-3 hidden md:grid md:grid-cols-12 md:items-center md:gap-3 hover:bg-neutral-900/40 transition-colors",children:[e.jsxs("div",{className:"md:col-span-4 flex items-start gap-3",children:[e.jsx(H,{size:"sm",onClick:()=>m(!0),className:"h-8 w-8 p-0 bg-red-600/10 border border-red-500/40 text-red-400 hover:bg-red-600/20 shrink-0 mt-0.5",title:"Excluir usuário",children:e.jsx(O,{className:"h-4 w-4"})}),e.jsx("div",{className:"mt-0.5 flex h-9 w-9 items-center justify-center rounded-lg bg-neutral-800 border border-neutral-700 shrink-0",children:e.jsx(P,{className:"h-4 w-4 text-neutral-200"})}),e.jsx("div",{className:"space-y-0.5 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(X,{className:"bg-neutral-800/50 border border-neutral-700 text-neutral-400 text-[10px] font-mono",children:["ID: ",s.id]}),"name"===l?e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(Y,{value:i.name,onChange:e=>c({...i,name:e.target.value}),className:"bg-neutral-800 border-neutral-600 text-white text-sm h-7",disabled:h,autoFocus:!0}),e.jsx(H,{size:"sm",onClick:()=>w("name"),disabled:h,className:"h-7 w-7 p-0 bg-green-600 hover:bg-green-500",children:e.jsx(b,{className:"h-3 w-3"})}),e.jsx(H,{size:"sm",onClick:f,disabled:h,className:"h-7 w-7 p-0 bg-neutral-600 hover:bg-neutral-500",children:e.jsx(N,{className:"h-3 w-3"})})]}):e.jsx("span",{className:"text-sm font-semibold text-white truncate cursor-pointer hover:bg-neutral-800 px-2 py-1 rounded",onDoubleClick:()=>j("name"),children:s.name}),n&&e.jsx(X,{className:"bg-emerald-600/20 border border-emerald-500/40 text-emerald-200 text-[10px] uppercase tracking-wide",children:"Admin"})]})})]}),e.jsxs("div",{className:"md:col-span-3 flex items-center gap-2 text-xs text-neutral-300",children:[e.jsx(R,{className:"h-3.5 w-3.5 text-neutral-400 shrink-0"}),"email"===l?e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(Y,{value:i.email,onChange:e=>c({...i,email:e.target.value}),className:"bg-neutral-800 border-neutral-600 text-white text-xs h-7",disabled:h,autoFocus:!0}),e.jsx(H,{size:"sm",onClick:()=>w("email"),disabled:h,className:"h-7 w-7 p-0 bg-green-600 hover:bg-green-500",children:e.jsx(b,{className:"h-3 w-3"})}),e.jsx(H,{size:"sm",onClick:f,disabled:h,className:"h-7 w-7 p-0 bg-neutral-600 hover:bg-neutral-500",children:e.jsx(N,{className:"h-3 w-3"})})]}):e.jsx("span",{className:"truncate cursor-pointer hover:bg-neutral-800 px-2 py-1 rounded flex-1",onDoubleClick:()=>j("email"),children:s.email})]}),e.jsx("div",{className:"md:col-span-2 flex items-center gap-2 text-xs",children:e.jsx(X,{className:"bg-neutral-800 border border-neutral-700 text-neutral-200 text-[11px] cursor-pointer hover:bg-neutral-700",onClick:S,children:Ge[i.role]||i.role})}),e.jsxs("div",{className:"md:col-span-2 flex items-center gap-2 text-xs",children:["ativo"===i.status&&e.jsxs(X,{className:"bg-emerald-600/15 border border-emerald-500/40 text-emerald-200 text-[11px] inline-flex items-center gap-1 cursor-pointer hover:bg-emerald-600/25",onClick:y,children:[e.jsx(U,{className:"h-3 w-3"}),Je[i.status]]}),"analise"===i.status&&e.jsxs(X,{className:"bg-amber-500/10 border border-amber-400/40 text-amber-200 text-[11px] inline-flex items-center gap-1 cursor-pointer hover:bg-amber-500/20",onClick:y,children:[e.jsx(z,{className:"h-3 w-3"}),Je[i.status]]}),"banido"===i.status&&e.jsxs(X,{className:"bg-red-600/10 border border-red-500/40 text-red-200 text-[11px] inline-flex items-center gap-1 cursor-pointer hover:bg-red-600/20",onClick:y,children:[e.jsx(A,{className:"h-3 w-3"}),Je[i.status]]})]}),e.jsx("div",{className:"md:col-span-1 md:text-right text-xs text-neutral-400",children:s.lastAccess}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg p-4 max-w-sm w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(_,{className:"h-5 w-5 text-amber-400"}),e.jsx("h3",{className:"text-white font-semibold",children:"Confirmar mudança de perfil"})]}),e.jsx("p",{className:"text-neutral-300 text-sm mb-4",children:"Tem certeza que deseja promover este usuário para Administrador? Esta ação concederá acesso completo ao painel administrativo."}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(H,{onClick:()=>u(!1),className:"bg-neutral-700 hover:bg-neutral-600",children:"Cancelar"}),e.jsx(H,{onClick:k,className:"bg-green-600 hover:bg-green-500",disabled:h,children:h?"Salvando...":"Confirmar"})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg p-4 max-w-sm w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(O,{className:"h-5 w-5 text-red-400"}),e.jsx("h3",{className:"text-white font-semibold",children:"Confirmar exclusão"})]}),e.jsxs("p",{className:"text-neutral-300 text-sm mb-2",children:["Tem certeza que deseja excluir o usuário"," ",e.jsx("span",{className:"text-white font-semibold",children:s.name}),"?"]}),e.jsxs("p",{className:"text-neutral-400 text-xs mb-4",children:["ID: ",s.id," • ",s.email]}),e.jsx("p",{className:"text-red-400 text-sm mb-4",children:"⚠️ Esta ação não pode ser desfeita. Todos os dados do usuário serão permanentemente removidos."}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(H,{onClick:()=>m(!1),className:"bg-neutral-700 hover:bg-neutral-600",disabled:h,children:"Cancelar"}),e.jsx(H,{onClick:v,className:"bg-red-600 hover:bg-red-500",disabled:h,children:h?"Excluindo...":"Excluir"})]})]})})]})]})}function Ye({isOpen:s,onOpenChange:a,title:t,description:r,confirmText:n="Excluir",cancelText:l="Cancelar",onConfirm:i,variant:h="destructive"}){const[b,j]=p.useState(!1);return e.jsx(o,{open:s,onOpenChange:a,children:e.jsxs(c,{className:"bg-neutral-950 border-neutral-800 text-white max-w-md",children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full "+("destructive"===h?"bg-red-600/20 text-red-400":"bg-blue-600/20 text-blue-400"),children:e.jsx(_,{className:"h-5 w-5"})}),e.jsx(u,{className:"text-lg font-semibold",children:t})]})}),e.jsx(x,{className:"text-neutral-300",children:r}),e.jsxs(m,{className:"gap-2",children:[e.jsx(H,{onClick:()=>a(!1),disabled:b,className:"border border-neutral-700 text-white hover:bg-neutral-800",children:l}),e.jsx(H,{variant:h,onClick:async()=>{j(!0);try{await i(),a(!1)}finally{j(!1)}},disabled:b,className:"destructive"===h?"bg-red-600 hover:bg-red-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white",children:b?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 animate-spin"}),"Excluindo..."]}):n})]})]})})}function Qe({isOpen:s,onOpenChange:a,categoryName:t,onCategoryNameChange:r,categoryDescription:n,onCategoryDescriptionChange:l,onUpdateCategory:i,isLoading:h=!1}){return e.jsx(o,{open:s,onOpenChange:a,children:e.jsxs(c,{className:"bg-neutral-950 border-neutral-800 text-white",children:[e.jsxs(d,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-blue-600/20 text-blue-400",children:e.jsx(k,{className:"h-5 w-5"})}),e.jsx(u,{children:"Editar Categoria"})]}),e.jsx(x,{className:"text-neutral-400",children:"Altere o nome da categoria. Esta ação será aplicada imediatamente."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsx(Y,{value:t,onChange:e=>r(e.target.value),className:"bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500",placeholder:"Nome da categoria",onKeyDown:e=>{"Enter"===e.key&&t.trim()&&i()},disabled:h}),e.jsx("textarea",{value:n,onChange:e=>l(e.target.value),className:"w-full bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500 rounded-md px-3 py-2 text-sm resize-none h-20 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent",placeholder:"Descrição da categoria",rows:3,disabled:h,required:!0})]}),e.jsxs(m,{children:[e.jsx(H,{onClick:()=>a(!1),disabled:h,className:"border border-neutral-700 text-white hover:bg-neutral-800",children:"Cancelar"}),e.jsx(H,{onClick:i,disabled:!t.trim()||!n.trim()||h,className:"bg-blue-600 hover:bg-blue-700",children:h?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 animate-spin"}),"Salvando..."]}):"Salvar Alterações"})]})]})})}function We({isOpen:s,onOpenChange:a,courseTitle:t,onCourseTitleChange:r,courseDescription:n,onCourseDescriptionChange:l,onUpdateCourse:i,categoryName:h,isLoading:p=!1}){return e.jsx(o,{open:s,onOpenChange:a,children:e.jsxs(c,{className:"bg-neutral-950 border-neutral-800 text-white",children:[e.jsxs(d,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-blue-600/20 text-blue-400",children:e.jsx(k,{className:"h-5 w-5"})}),e.jsx(u,{children:"Editar Curso"})]}),e.jsx(x,{className:"text-neutral-400",children:h?`Alterando o título do curso na categoria: ${h}`:"Alterando o título do curso."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsx(Y,{value:t,onChange:e=>r(e.target.value),className:"bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500",placeholder:"Título do curso",onKeyDown:e=>{"Enter"===e.key&&t.trim()&&i()},disabled:p}),e.jsx("textarea",{value:n,onChange:e=>l(e.target.value),className:"w-full bg-neutral-900 border-neutral-700 text-white placeholder:text-neutral-500 rounded-md px-3 py-2 text-sm resize-none h-20 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent",placeholder:"Descrição do curso",rows:3,disabled:p,required:!0})]}),e.jsxs(m,{children:[e.jsx(H,{onClick:()=>a(!1),disabled:p,className:"border border-neutral-700 text-white hover:bg-neutral-800",children:"Cancelar"}),e.jsx(H,{onClick:i,disabled:!t.trim()||!n.trim()||p,className:"bg-blue-600 hover:bg-blue-700",children:p?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 animate-spin"}),"Salvando..."]}):"Salvar Alterações"})]})]})})}function Xe(){const[s,a]=p.useState("courses"),[t,r]=p.useState(new Set),[n,l]=p.useState(new Set),[o,i]=p.useState({type:"category",categoryId:null,courseId:null,lessonId:null}),[c,d]=p.useState(""),[u,x]=p.useState(!1),[m,h]=p.useState(""),[b,j]=p.useState(""),[f,v]=p.useState(!1),[N,w]=p.useState(""),[y,C]=p.useState(""),[S,k]=p.useState(!1),[E,O]=p.useState(""),[D,T]=p.useState(""),[I,L]=p.useState(""),[A,z]=p.useState(null),[P,R]=p.useState(!1),[U,_]=p.useState([]),[$,q]=p.useState(!0),[M,B]=p.useState(null),[H,K]=p.useState({}),[Y,Q]=p.useState({}),[W,X]=p.useState({}),[Z,ee]=p.useState({}),[me,he]=p.useState(null),[ge,pe]=p.useState(!1),[be,je]=p.useState(""),[fe,ve]=p.useState(""),[Ne,we]=p.useState(null),[ye,Ce]=p.useState(!1),[Se,ke]=p.useState(""),[Ee,Oe]=p.useState(""),[De,Te]=p.useState(!1),[Ie,Le]=p.useState(!1),[Ae,ze]=p.useState(!1),[Re,Ue]=p.useState(!1),[$e,qe]=p.useState(!1),[Fe,Je]=p.useState(!1),{showConfirmDialog:Ge,ConfirmDialogComponent:He}=function(){const[s,a]=p.useState({isOpen:!1,title:"",description:"",onConfirm:null,confirmText:"Excluir",cancelText:"Cancelar",variant:"destructive"}),t=()=>{a(e=>({...e,isOpen:!1}))};return{showConfirmDialog:e=>{a({isOpen:!0,title:e.title||"Confirmar exclusão",description:e.description||"Tem certeza que deseja continuar?",onConfirm:e.onConfirm||(()=>{}),confirmText:e.confirmText||"Excluir",cancelText:e.cancelText||"Cancelar",variant:e.variant||"destructive"})},hideDialog:t,ConfirmDialogComponent:()=>e.jsx(Ye,{isOpen:s.isOpen,onOpenChange:t,title:s.title,description:s.description,confirmText:s.confirmText,cancelText:s.cancelText,onConfirm:s.onConfirm,variant:s.variant})}}();p.useEffect(()=>{(async()=>{try{q(!0);const e=await se();_(e?.Result?.categories||[]),B(null)}catch(e){B(e.message),_([])}finally{q(!1)}})()},[]);const Ke=async e=>{const s=new Set(t);if(!s.has(e)){if(s.add(e),r(s),!Y[e])try{K(s=>({...s,[e]:!0}));const s=await ue(e),a=s?.Result?.courses||[];Q(s=>({...s,[e]:a}))}catch(a){}finally{K(s=>({...s,[e]:!1}))}}else s.delete(e),r(s)},Xe=async e=>{const s=new Set(n);if(!s.has(e)){if(s.add(e),l(s),!Z[e])try{X(s=>({...s,[e]:!0}));const s=await xe(e),a=s?.Result?.lessons||[];ee(s=>({...s,[e]:a}))}catch(a){}finally{X(s=>({...s,[e]:!1}))}}else s.delete(e),l(s)},es=p.useMemo(()=>{const e=c.trim().toLowerCase();return e?U.map(s=>{const a=(Y[s.id]||[]).map(e=>({...e,lessons:Z[e.id]||[]})),t=s.name.toLowerCase().includes(e),r=a.map(s=>{const a=s.title.toLowerCase().includes(e),t=s.lessons.filter(s=>s.title.toLowerCase().includes(e));return a?s:t.length>0?{...s,lessons:t}:null}).filter(Boolean);return t?{...s,courses:a}:r.length>0?{...s,courses:r}:null}).filter(Boolean):U.map(e=>({...e,courses:(Y[e.id]||[]).map(e=>({...e,lessons:Z[e.id]||[]}))}))},[c,U,Y,Z]),ss=p.useMemo(()=>{if("category"===o.type){return{category:U.find(e=>e.id===o.categoryId)||null,course:null,lesson:null}}if("course"===o.type){return{category:U.find(e=>e.id===o.categoryId)||null,course:(Y[o.categoryId]||[]).map(e=>({...e,lessons:Z[e.id]||[]})).find(e=>e.id===o.courseId)||null,lesson:null}}if("lesson"===o.type){const e=U.find(e=>e.id===o.categoryId)||null,s=(Y[o.categoryId]||[]).map(e=>({...e,lessons:Z[e.id]||[]})).find(e=>e.id===o.courseId)||null,a=s?.lessons?.find(e=>e.id===o.lessonId)||null;return{category:e,course:s,lesson:a}}return{category:null,course:null,lesson:null}},[o,U,Y,Z]),as=e=>{z(e),R(!0)},ts=e=>{he(e),je(e.name||""),ve(e.description||""),pe(!0)},rs=(e,s)=>{U.find(s=>s.id===e),we({...s,categoryId:e}),ke(s.title||""),Oe(s.description||""),Ce(!0)},ns=e=>{const s=U.find(s=>s.id===e);Ge({title:"Excluir Categoria",description:`Tem certeza que deseja excluir a categoria "${s?.name}" e todo o seu conteúdo? Esta ação não pode ser desfeita.`,confirmText:"Excluir Categoria",onConfirm:async()=>{try{await re(e);const s=await se();_(s?.Result?.categories||[]),"category"===o.type&&o.categoryId===e&&i({type:"category",categoryId:null,courseId:null,lessonId:null})}catch(s){}}})},ls=(e,s)=>{U.find(s=>s.id===e);const a=Y[e]?.find(e=>e.id===s);Ge({title:"Excluir Curso",description:`Tem certeza que deseja excluir o curso "${a?.title}" e todas as suas aulas? Esta ação não pode ser desfeita.`,confirmText:"Excluir Curso",onConfirm:async()=>{try{await oe(s);const a=await ue(e),t=a?.Result?.courses||[];Q(s=>({...s,[e]:t})),"course"===o.type&&o.courseId===s&&i({type:"category",categoryId:null,courseId:null,lessonId:null})}catch(a){}}})},os=(e,s,a)=>{U.find(s=>s.id===e),Y[e]?.find(e=>e.id===s);const t=Z[s]?.find(e=>e.id===a);Ge({title:"Excluir Aula",description:`Tem certeza que deseja excluir a aula "${t?.title}"? Esta ação não pode ser desfeita.`,confirmText:"Excluir Aula",onConfirm:async()=>{try{await de(a);const t=await xe(s),r=t?.Result?.lessons||[];ee(e=>({...e,[s]:r})),"lesson"===o.type&&o.lessonId===a&&i({type:"course",categoryId:e,courseId:s,lessonId:null})}catch(t){}}})},is={isOpen:u,onOpenChange:x,categoryName:m,onCategoryNameChange:h,categoryDescription:b,onCategoryDescriptionChange:j,onCreateCategory:async()=>{if(m.trim()&&b.trim())try{Te(!0),await ae(m.trim(),b.trim());const e=await se();_(e?.Result?.categories||[]),h(""),j(""),x(!1)}catch(e){}finally{Te(!1)}},isLoading:De},cs={isOpen:f,onOpenChange:v,courseTitle:N,onCourseTitleChange:w,courseDescription:y,onCourseDescriptionChange:C,onCreateCourse:async()=>{if(N.trim()&&y.trim()&&o.categoryId)try{Le(!0),await ne(o.categoryId,N.trim(),y.trim());const e=await ue(o.categoryId),s=e?.Result?.courses||[];Q(e=>({...e,[o.categoryId]:s})),w(""),C(""),v(!1),r(new Set([...t,o.categoryId]))}catch(e){}finally{Le(!1)}},selectedCategoryId:o.categoryId,categories:U,isLoading:Ie},ds={isOpen:S,onOpenChange:k,lessonTitle:E,onLessonTitleChange:O,lessonDuration:D,onLessonDurationChange:T,lessonDescription:I,onLessonDescriptionChange:L,onCreateLesson:async()=>{if(E.trim()&&D.trim()&&I.trim()&&o.categoryId&&o.courseId)try{ze(!0),await ie(o.courseId,E.trim(),D.trim(),I.trim());const e=await xe(o.courseId),s=e?.Result?.lessons||[];ee(e=>({...e,[o.courseId]:s})),O(""),T(""),L(""),k(!1),r(new Set([...t,o.categoryId])),l(new Set([...n,o.courseId]))}catch(e){}finally{ze(!1)}},selectedCategoryId:o.categoryId,selectedCourseId:o.courseId,categories:U,isLoading:Ae};return e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-xl bg-neutral-950 border border-neutral-800 p-1 w-full sm:w-auto",children:[e.jsx(Ze,{label:"Conteúdo",description:"Categorias, cursos e aulas",isActive:"courses"===s,onClick:()=>a("courses")}),e.jsx(Ze,{label:"Usuários",description:"Alunos e administradores",isActive:"users"===s,onClick:()=>a("users")})]}),"courses"===s&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{query:c,onQueryChange:d,categoryDialogProps:is,courseDialogProps:cs,lessonDialogProps:ds}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-5 gap-4",children:[e.jsxs(F,{className:"xl:col-span-2 lg:col-span-1 bg-neutral-950 border-neutral-800 text-white shadow-2xl",children:[e.jsxs(J,{className:"pb-4",children:[e.jsx(G,{className:"text-lg font-semibold",children:"Estrutura"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"Categoria → Curso → Aula"})]}),e.jsxs(V,{className:"space-y-3",children:[$&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-neutral-400 py-4",children:[e.jsx(g,{className:"h-4 w-4 animate-spin shrink-0"}),"Carregando categorias..."]}),M&&e.jsxs("div",{className:"text-sm text-red-400",children:["Erro: ",M]}),!$&&!M&&0===es.length&&e.jsx("div",{className:"text-sm text-neutral-400",children:"Nenhuma categoria encontrada."}),!$&&!M&&es.map(s=>e.jsx(_e,{category:s,isExpanded:t.has(s.id),onToggle:Ke,onSelect:i,isSelected:"category"===o.type&&o.categoryId===s.id,expandedCourses:n,onCourseToggle:Xe,onCourseSelect:i,onLessonSelect:i,selected:o,onEditLesson:as,onDeleteCategory:ns,onDeleteCourse:ls,onDeleteLesson:os,onEditCategory:ts,onEditCourse:rs,loadingCourses:H,loadingLessons:W},s.id))]})]}),e.jsx(F,{className:"hidden xl:block xl:col-span-3 bg-neutral-950 border-neutral-800 text-white shadow-2xl",children:e.jsx(V,{className:"pt-4",children:e.jsx(Me,{selectedData:ss,selected:o,onEditLesson:as,onDeleteCategory:ns,onDeleteCourse:ls,onDeleteLesson:os,onEditCategory:ts,onEditCourse:rs,lessonDialogProps:ds})})})]})]}),"users"===s&&e.jsx(Ve,{}),e.jsx(Pe,{isOpen:P,onOpenChange:e=>{R(e),e||z(null)},lesson:A,onSaveLesson:async e=>{try{Je(!0),await ce(e.id,e.title,e.duration,e.description,e.isPaid);const s=await xe(o.courseId),a=s?.Result?.lessons||[];ee(e=>({...e,[o.courseId]:a})),z(null)}catch(s){}finally{Je(!1)}},categories:U,isLoading:Fe}),e.jsx(Qe,{isOpen:ge,onOpenChange:pe,categoryName:be,onCategoryNameChange:je,categoryDescription:fe,onCategoryDescriptionChange:ve,onUpdateCategory:async()=>{if(me&&be.trim()&&fe.trim())try{Ue(!0),await te(me.id,be.trim(),fe.trim());const e=await se();_(e?.Result?.categories||[]),pe(!1),he(null),je(""),ve("")}catch(e){}finally{Ue(!1)}},isLoading:Re}),e.jsx(We,{isOpen:ye,onOpenChange:Ce,courseTitle:Se,onCourseTitleChange:ke,courseDescription:Ee,onCourseDescriptionChange:Oe,onUpdateCourse:async()=>{if(Ne&&Se.trim()&&Ee.trim())try{qe(!0),await le(Ne.id,Se.trim(),Ee.trim());const e=await ue(Ne.categoryId),s=e?.Result?.courses||[];Q(e=>({...e,[Ne.categoryId]:s})),Ce(!1),we(null),ke(""),Oe("")}catch(e){}finally{qe(!1)}},categoryName:Ne?U.find(e=>e.id===Ne.categoryId)?.name:"",isLoading:$e}),e.jsx(He,{})]})}function Ze({label:s,description:a,isActive:t,onClick:r}){return e.jsxs("button",{type:"button",onClick:r,className:"flex-1 sm:flex-none px-3 sm:px-4 py-2 rounded-lg text-left transition-colors "+(t?"bg-green-600/15 border border-green-500/40 shadow-[0_0_0_1px_rgba(22,163,74,0.4)]":"border border-transparent hover:border-neutral-700 hover:bg-neutral-900/70"),children:[e.jsx("div",{className:"text-xs font-semibold tracking-wide uppercase text-neutral-400",children:s}),e.jsx("div",{className:"text-[11px] text-neutral-500",children:a})]})}function es({open:s,onOpenChange:a}){return e.jsx(o,{open:s,onOpenChange:a,children:e.jsxs(c,{"data-dashboard-dialog":!0,className:"bg-neutral-950 border-neutral-800 text-white !w-[85vw] !h-[85vh] !max-w-none !max-h-none !m-0 !rounded-lg !p-0 !top-[50%] !left-[50%] !translate-x-[-50%] !translate-y-[-50%] !flex !flex-col !gap-0 !overflow-hidden",children:[e.jsxs(d,{className:"px-4 sm:px-6 py-4 border-b border-neutral-800 shrink-0",children:[e.jsx(u,{className:"text-xl sm:text-2xl font-bold text-white",children:"Dashboard Administrativo"}),e.jsx(x,{className:"text-neutral-400",children:"Gerencie categorias, cursos, aulas e usuários da plataforma"})]}),e.jsx("div",{"data-dashboard-scroll":!0,className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden scrollbar-hide px-4 sm:px-6 py-4",children:e.jsx(Xe,{})})]})})}export{es as DashboardDialog,es as default};
