import{B as e,_ as t}from"./index-BKZd7x9Y.js";import{j as s}from"./radix-vendor-BHqWp7OE.js";import{a as r,X as a,P as n,_ as l,$ as i,a0 as o,L as c,a1 as d,a2 as u,a3 as m,a4 as x,a5 as h,h as p,B as f}from"./utils-kdHwbi2o.js";import{D as v,a as b,b as g,c as j,d as w,e as N}from"./dialog-Bvw5xnUM.js";import{c as y}from"./home-D1eJPZth.js";import{d as C}from"./logo-Dshb9xAf.js";import"./react-vendor-B9Gi-rSJ.js";import"./index-BKhFsyqK.js";function E({courseTitle:E,courseId:S,children:k,open:P,onOpenChange:L}){const[A,T]=r.useState(!1),R=void 0!==P?P:A,z=L||T,[M,$]=r.useState(!1),[B,O]=r.useState(0),[I,U]=r.useState(0),[q,_]=r.useState(0),[F,D]=r.useState(0),[H,J]=r.useState(0),[V,W]=r.useState(null),[G,X]=r.useState([]),[K,Q]=r.useState(!1),[Y,Z]=r.useState(null),[ee,te]=r.useState(!1),[se,re]=r.useState(null),[ae,ne]=r.useState(!1),le=r.useRef(null),ie=r.useRef(null),oe=r.useRef(null);r.useEffect(()=>{R||(U(0),le.current&&(le.current.volume=0,le.current.muted=!0))},[R]);const ce=r.useCallback((e,t)=>{const s=document.createElement("canvas");s.width=320,s.height=180;const r=s.getContext("2d"),a=r.createLinearGradient(0,0,320,180);a.addColorStop(0,"#059669"),a.addColorStop(1,"#047857"),r.fillStyle=a,r.fillRect(0,0,320,180),r.fillStyle="white",r.font="bold 24px sans-serif",r.textAlign="center",r.textBaseline="middle";const n=e.split(" ");let l="",i=90;for(let o=0;o<n.length;o++){const e=l+n[o]+" ";r.measureText(e).width>280&&o>0?(r.fillText(l,160,i),l=n[o]+" ",i+=30):l=e}return r.fillText(l,160,i),s.toDataURL()},[]),de=r.useMemo(()=>[{id:"l1",title:"Introdução ao Curso",duration:"12:45",description:"Conceitos fundamentais e estrutura do curso",thumbnail:ce("Introdução ao Curso",0),isPaid:!1},{id:"l2",title:"Configuração do Ambiente",duration:"18:30",description:"Setup das ferramentas e ambiente de desenvolvimento",thumbnail:ce("Configuração do Ambiente",1),isPaid:!1},{id:"l3",title:"Primeiros Passos Práticos",duration:"25:15",description:"Exercícios práticos iniciais",thumbnail:ce("Primeiros Passos Práticos",2),isPaid:!0},{id:"l4",title:"Técnicas Avançadas",duration:"32:20",description:"Conceitos avançados e aplicações",thumbnail:ce("Técnicas Avançadas",3),isPaid:!0}],[]);r.useEffect(()=>{if(R&&S){(async()=>{try{Q(!0),Z(null);const e=await y.getLessonsByCourse(S),t=(e?.Result?.lessons||[]).map(e=>({id:`l${e.id}`,title:e.title,duration:e.duration,description:e.description||"Aula prática do curso",thumbnail:`https://images.unsplash.com/photo-${Math.floor(1e9*Math.random())}?w=800&h=450&fit=crop`,isPaid:e.isPaid||!1}));X(t)}catch(e){Z(e.message),X([])}finally{Q(!1)}})()}},[R,S]);const ue=r.useMemo(()=>[...G.length>0?G:de].sort((e,t)=>(e.isPaid?1:0)-(t.isPaid?1:0)),[G,de]);r.useEffect(()=>{R&&G.length>0&&(O(0),$(!1),re(null),_(0),J(0),W(null),te(!1),U(0),le.current&&(le.current.volume=0,le.current.muted=!0))},[G,R]),r.useEffect(()=>{if(R&&ue[B]){const e=ue[B];if(e.isPaid)return te(!1),void re(null);const t=e.id;me(t)}return()=>{ie.current&&(ie.current.destroy(),ie.current=null),le.current&&(le.current.src="",le.current.volume=0,le.current.muted=!0),U(0)}},[R,B,ue]);const me=async e=>{if(le.current)try{te(!0),re(null),ie.current&&(ie.current.destroy(),ie.current=null);const r=await y.getSignedUrl(e);if(!r)throw new Error("Resposta vazia da API");if(r.includes("StatusCode"))try{const e=JSON.parse(r);if(500===e.StatusCode)return re(`Aula não encontrada: ${e.StatusMessage}`),void te(!1)}catch(s){}if(!r.includes("#EXTM3U"))throw new Error("Resposta não contém playlist M3U8 válido");const a=new Blob([r],{type:"application/vnd.apple.mpegurl"}),n=URL.createObjectURL(a);ne(!0);const l=await(async()=>{if(oe.current)return oe.current;try{const e=(await t(()=>import("./hls-DBz5ildx.js"),[])).default;return oe.current=e,e}catch(e){throw new Error("Não foi possível carregar o player de vídeo")}})();if(ne(!1),l.isSupported()){const t=new l({enableWorker:!0,lowLatencyMode:!1,maxBufferLength:60,maxMaxBufferLength:120,backBufferLength:30,maxBufferHole:.5,fetchSetup:function(t,s){if(t.url&&t.url.includes("/api/video/key")){const t=C(),s={lessonId:e};return{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(s)}}return s},xhrSetup:function(t,s){if(s&&s.includes("/api/video/key")){const r=C(),a={lessonId:e};t.open("POST",s),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",`Bearer ${r}`);const n=JSON.stringify(a),l=t.send;t.send=function(){l.call(this,n)}}}});return ie.current=t,t.loadSource(n),t.attachMedia(le.current),t.on(l.Events.MANIFEST_PARSED,()=>{le.current.play().catch(e=>{})}),t.on(l.Events.ERROR,(e,t)=>{"keySystemError"!==t.type&&"keyLoadError"!==t.type?t.fatal&&re("Erro ao carregar o vídeo"):re("Erro ao obter chave de descriptografia. Verifique sua autenticação.")}),()=>{URL.revokeObjectURL(n)}}if(!le.current.canPlayType("application/vnd.apple.mpegurl"))throw new Error("HLS não suportado neste navegador");le.current.src=n,le.current.play().catch(e=>{})}catch(r){re("Erro ao carregar o vídeo. Usando conteúdo de demonstração.")}finally{te(!1),ne(!1)}},xe=async()=>{if(le.current)try{M?le.current.pause():await le.current.play(),$(!M)}catch(e){"AbortError"!==e.name&&re("Erro ao reproduzir o vídeo")}},he=e=>{if(!e||isNaN(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`},pe=r.useMemo(()=>({style:{background:`linear-gradient(to right, #10b981 0%, #10b981 ${I}%, #4b5563 ${I}%, #4b5563 100%)`}}),[I]),fe=r.useMemo(()=>({style:{background:`linear-gradient(to right, #10b981 0%, #10b981 ${q}%, #4b5563 ${q}%, #4b5563 100%)`}}),[q]);return r.useEffect(()=>{le.current&&(le.current.volume=I/100,le.current.muted=0===I)},[I]),r.useEffect(()=>{const e=le.current;if(!e)return;let t;const s=()=>{J(e.currentTime),D(e.duration||0),_(e.duration?e.currentTime/e.duration*100:0),e.paused||e.ended||(t=requestAnimationFrame(s))},r=()=>{s()},a=()=>{s()},n=()=>{t&&cancelAnimationFrame(t)};return e.addEventListener("loadedmetadata",r),e.addEventListener("play",a),e.addEventListener("pause",n),e.addEventListener("seeked",s),()=>{e.removeEventListener("loadedmetadata",r),e.removeEventListener("play",a),e.removeEventListener("pause",n),e.removeEventListener("seeked",s),t&&cancelAnimationFrame(t)}},[le.current]),s.jsxs(v,{open:R,onOpenChange:z,children:[k&&s.jsx(b,{asChild:!0,children:k}),s.jsx(g,{showCloseButton:!1,className:"bg-neutral-950 border-neutral-800 text-white max-w-[98vw]! w-[98vw]! h-[95dvh]! max-h-[95dvh]! overflow-hidden p-0! sm:max-w-none! sm:h-[95vh]! sm:max-h-[95vh]!",children:s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs(j,{className:"px-4 py-3 sm:px-6 sm:py-4 border-b border-neutral-800 relative",children:[s.jsx(e,{onClick:()=>z(!1),className:"absolute right-2 top-2 sm:right-4 sm:top-4 text-white hover:bg-white/20 rounded-full p-2 h-8 w-8 sm:h-10 sm:w-10",variant:"ghost",size:"icon",children:s.jsx(a,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),s.jsx(w,{className:"text-lg sm:text-xl font-bold text-white pr-12 sm:pr-16",children:E}),s.jsx(N,{className:"text-neutral-400 hidden sm:block",children:"Aulas práticas e exemplos reais"})]}),s.jsxs("div",{className:"flex flex-1 overflow-hidden flex-col sm:flex-row",children:[s.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[s.jsxs("div",{className:"relative bg-black flex items-center justify-center w-full aspect-video overflow-hidden sm:aspect-auto sm:flex-1 sm:min-h-0",children:[s.jsx("div",{className:"absolute inset-0 bg-linear-to-b from-transparent via-transparent to-black/50 z-10"}),s.jsx("video",{ref:le,className:"absolute inset-0 z-0 w-full h-full object-contain",controls:!1,playsInline:!0,muted:!0,autoPlay:!0,onPlay:()=>{$(!0),W(null)},onPause:()=>$(!1),onLoadedMetadata:()=>{V||(()=>{const e=le.current;if(!e)return;const t=document.createElement("canvas");t.width=e.videoWidth||1280,t.height=e.videoHeight||720;const s=t.getContext("2d");e.currentTime=2;const r=()=>{e.readyState>=2?(s.drawImage(e,0,0,t.width,t.height),W(t.toDataURL()),e.currentTime=0):setTimeout(r,100)};setTimeout(r,500)})()},poster:V}),!M&&V&&!ee&&!se&&s.jsxs("div",{className:"absolute inset-0 z-10",children:[s.jsx("img",{src:V,alt:"Video poster",className:"w-full h-full object-contain"}),s.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center",children:s.jsx("button",{onClick:xe,className:"bg-green-600 hover:bg-green-500 rounded-full p-6 transition-all duration-200 transform hover:scale-110 shadow-2xl backdrop-blur-sm border-2 border-white/20",children:s.jsx(n,{className:"h-12 w-12 text-white ml-1"})})})]}),ue[B]?.isPaid&&s.jsx("div",{className:"absolute inset-0 bg-black/90 flex items-center justify-center z-40",children:s.jsxs("div",{className:"text-center p-6 max-w-sm",children:[s.jsx("div",{className:"mb-6",children:s.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-linear-to-br from-green-600 to-green-500 shadow-lg shadow-green-500/25",children:s.jsx(l,{className:"h-10 w-10 text-white"})})}),s.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[s.jsx(i,{className:"h-5 w-5 text-green-400"}),s.jsx("h3",{className:"text-2xl font-bold text-green-400",children:"Conteúdo Exclusivo"}),s.jsx(i,{className:"h-5 w-5 text-green-400"})]}),s.jsx("p",{className:"text-neutral-300 mb-6 text-sm",children:"Esta aula faz parte do pacote completo do curso. Adquira acesso vitalício a todo o conteúdo."}),s.jsxs("div",{className:"space-y-2 mb-6 text-left",children:[s.jsxs("div",{className:"flex items-center gap-2 text-neutral-300 text-sm",children:[s.jsx(o,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{children:"Acesso vitalício às aulas"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-neutral-300 text-sm",children:[s.jsx(o,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{children:"Conteúdo exclusivo e avançado"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-neutral-300 text-sm",children:[s.jsx(o,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{children:"Suporte prioritário"})]})]}),s.jsxs(e,{className:"w-full bg-green-600 hover:bg-green-500 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg shadow-green-500/25 border border-green-600/30",onClick:()=>{},children:[s.jsx(i,{className:"h-4 w-4 mr-2"}),"Comprar Agora"]}),s.jsx("p",{className:"text-neutral-500 text-xs mt-4",children:"Pagamento único • Acesso vitalício"})]})}),(ee||ae)&&s.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center z-30",children:s.jsxs("div",{className:"text-center",children:[s.jsx(c,{className:"h-8 w-8 animate-spin text-white mx-auto mb-2"}),s.jsx("p",{className:"text-white text-sm",children:ae?"Carregando player de vídeo...":"Carregando vídeo..."})]})}),se&&s.jsx("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center z-30",children:s.jsxs("div",{className:"text-center p-4",children:[s.jsx("p",{className:"text-red-400 text-sm mb-2",children:se}),s.jsx(e,{variant:"outline",size:"sm",onClick:()=>me(ue[B].id),className:"text-white border-white/20 hover:bg-white/10",children:"Tentar novamente"})]})}),M&&0===I&&!ee&&!se&&s.jsx("div",{className:"absolute top-4 right-4 z-30 animate-pulse cursor-pointer",onClick:()=>{U(50),le.current&&(le.current.volume=.5,le.current.muted=!1)},children:s.jsxs("div",{className:"bg-red-600/90 backdrop-blur-sm rounded-lg px-3 py-2 flex items-center gap-2 border-2 border-red-400 hover:bg-red-500/90 transition-all shadow-lg shadow-red-500/30",children:[s.jsx(d,{className:"h-4 w-4 text-white"}),s.jsx("span",{className:"text-white text-sm font-bold",children:"Clique para ativar áudio"})]})}),!ee&&!se&&!V&&s.jsx("button",{onClick:xe,className:"absolute z-20 bg-white/20 backdrop-blur-sm rounded-full p-3 sm:p-4 hover:bg-white/30 transition-colors",children:M?s.jsx(u,{className:"h-6 w-6 sm:h-8 sm:w-8 text-white"}):s.jsx(n,{className:"h-6 w-6 sm:h-8 sm:w-8 text-white ml-1"})}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-linear-to-t from-black/80 to-transparent p-3 sm:p-4 z-20",children:[s.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[s.jsx(e,{variant:"ghost",size:"icon",onClick:xe,disabled:ee||ae||!!se,className:"text-white hover:bg-white/20 disabled:opacity-50",children:M?s.jsx(u,{className:"h-5 w-5"}):s.jsx(n,{className:"h-5 w-5"})}),s.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[s.jsx(m,{className:"h-4 w-4 text-white"}),s.jsx("input",{type:"range",min:"0",max:"100",value:I,onChange:e=>{const t=e.target.value;U(t),le.current&&(le.current.volume=t/100,le.current.muted=0===t)},className:"w-16 sm:w-24 h-1 bg-neutral-600 rounded-lg appearance-none cursor-pointer slider-volume",...pe}),0===I&&s.jsx("div",{className:"animate-pulse cursor-pointer hover:scale-110 transition-transform",onClick:()=>{U(50),le.current&&(le.current.volume=.5,le.current.muted=!1)},children:s.jsx(d,{className:"h-4 w-4 text-red-400"})}),I>0&&s.jsx(m,{className:"h-4 w-4 text-green-400"})]}),s.jsx("span",{className:"text-white text-xs min-w-[40px]",children:he(H)}),s.jsx(e,{variant:"ghost",size:"icon",onClick:()=>{le.current&&le.current.requestFullscreen&&le.current.requestFullscreen()},className:"text-white hover:bg-white/20",children:s.jsx(x,{className:"h-5 w-5"})})]}),s.jsxs("div",{className:"mt-3",children:[s.jsx("input",{type:"range",min:"0",max:"100",value:q,onChange:e=>{const t=e.target.value;if(_(t),le.current&&le.current.duration){const e=t/100*le.current.duration;le.current.currentTime=e,J(e)}},className:"w-full h-1 bg-neutral-600 rounded-lg appearance-none cursor-pointer slider-progress",...fe}),s.jsxs("div",{className:"flex justify-between mt-1",children:[s.jsx("span",{className:"text-xs text-neutral-400",children:he(H)}),s.jsx("span",{className:"text-xs text-neutral-400",children:he(F)})]})]})]})]}),s.jsxs("div",{className:"p-3 sm:p-4 border-t border-neutral-800",children:[s.jsx("h3",{className:"text-base sm:text-lg font-semibold text-white mb-2",children:ue[B].title}),s.jsx("p",{className:"text-neutral-400 text-sm",children:ue[B].description})]})]}),s.jsxs("div",{className:"w-full sm:w-80 max-h-[40dvh] sm:max-h-none border-t sm:border-t-0 sm:border-l border-neutral-800 flex flex-col min-h-0 overflow-hidden",children:[s.jsxs("div",{className:"p-3 sm:p-4 border-b border-neutral-800",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(h,{className:"h-5 w-5 text-green-400"}),s.jsx("h3",{className:"font-semibold text-white",children:"Aulas do Curso"})]}),s.jsxs("p",{className:"text-sm text-neutral-400 mt-1",children:[ue.length," aulas •"," ",ue.reduce((e,t)=>{const[s,r]=t.duration.split(":").map(Number);return e+s+r/60},0).toFixed(0),"min total"]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto",children:[K&&s.jsx("div",{className:"p-4 text-center text-neutral-400",children:"Carregando aulas..."}),Y&&s.jsx("div",{className:"p-4 text-center text-red-400",children:"Erro ao carregar aulas. Exibindo conteúdo de demonstração."}),!K&&!Y&&ue.map((e,t)=>s.jsx("div",{onClick:()=>(e=>{O(e),$(!1),re(null),_(0),J(0),W(null),U(0),le.current&&(le.current.volume=0,le.current.muted=!0)})(t),className:`p-3 sm:p-4 border-b border-neutral-800 cursor-pointer transition-colors ${B===t?"bg-neutral-800":"hover:bg-neutral-900"} ${e.isPaid?"opacity-90":""}`,children:s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("div",{className:"relative shrink-0 w-16 h-10 sm:w-20 sm:h-12 rounded overflow-hidden",children:[s.jsx("img",{src:e.thumbnail||ce(e.title,t),alt:e.title,className:"w-full h-full object-cover",onError:s=>{s.target.src=ce(e.title,t)}}),B===t&&M&&!e.isPaid&&s.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:s.jsx(u,{className:"h-4 w-4 text-white"})}),e.isPaid&&s.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:s.jsx(l,{className:"h-4 w-4 text-green-400"})})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h4",{className:"font-medium text-sm truncate "+(e.isPaid?"text-green-400":"text-white"),children:e.title}),e.isPaid&&s.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[s.jsx(i,{className:"h-3 w-3 text-green-400"}),s.jsx("span",{className:"text-xs font-semibold text-green-400",children:"Premium"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx(p,{className:"h-3 w-3 text-neutral-400"}),s.jsx("span",{className:"text-xs text-neutral-400",children:e.duration})]})]})]})},e.id))]}),s.jsx("div",{className:"p-3 sm:p-4 border-t border-neutral-800",children:s.jsxs(e,{variant:"ghost",className:"w-full border border-green-600/30 text-green-400 bg-neutral-900/50 hover:bg-green-600/10 hover:text-green-300",children:[s.jsx(f,{className:"h-4 w-4 mr-2"}),"Recursos do Curso"]})})]})]})]})})]})}export{E as VideoStreamingDialog,E as default};
