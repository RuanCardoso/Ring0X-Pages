import{B as e,_ as t}from"./index-Brba88ky.js";import{j as s}from"./radix-vendor-7IO1Nbx6.js";import{a as r,X as a,P as n,e as l,a1 as i,a2 as o,L as c,a3 as d,a4 as u,a5 as m,a6 as x,f as h,d as p,B as f}from"./utils--9QnDWEM.js";import{D as v,a as b,b as g,c as j,d as w,e as N}from"./dialog-BPHeBbwo.js";import{c as y}from"./home-Dl2GVdLL.js";import{j as S}from"./logo-DTWrhTh-.js";import"./react-vendor-DG3TdhJH.js";import"./index-CsQcsRtG.js";function C({courseTitle:C,courseId:E,children:k}){const[P,L]=r.useState(!1),[T,R]=r.useState(!1),[A,z]=r.useState(0),[M,$]=r.useState(0),[B,I]=r.useState(0),[O,U]=r.useState(0),[q,_]=r.useState(0),[D,H]=r.useState(null),[F,J]=r.useState([]),[V,W]=r.useState(!1),[G,X]=r.useState(null),[K,Q]=r.useState(!1),[Y,Z]=r.useState(null),[ee,te]=r.useState(!1),se=r.useRef(null),re=r.useRef(null),ae=r.useRef(null);r.useEffect(()=>{P||($(0),se.current&&(se.current.volume=0,se.current.muted=!0))},[P]);const ne=(e,t)=>{const s=document.createElement("canvas");s.width=320,s.height=180;const r=s.getContext("2d"),a=r.createLinearGradient(0,0,320,180);a.addColorStop(0,"#059669"),a.addColorStop(1,"#047857"),r.fillStyle=a,r.fillRect(0,0,320,180),r.fillStyle="white",r.font="bold 24px sans-serif",r.textAlign="center",r.textBaseline="middle";const n=e.split(" ");let l="",i=90;for(let o=0;o<n.length;o++){const e=l+n[o]+" ";r.measureText(e).width>280&&o>0?(r.fillText(l,160,i),l=n[o]+" ",i+=30):l=e}return r.fillText(l,160,i),s.toDataURL()},le=r.useMemo(()=>[{id:"l1",title:"Introdução ao Curso",duration:"12:45",description:"Conceitos fundamentais e estrutura do curso",thumbnail:ne("Introdução ao Curso"),isPaid:!1},{id:"l2",title:"Configuração do Ambiente",duration:"18:30",description:"Setup das ferramentas e ambiente de desenvolvimento",thumbnail:ne("Configuração do Ambiente"),isPaid:!1},{id:"l3",title:"Primeiros Passos Práticos",duration:"25:15",description:"Exercícios práticos iniciais",thumbnail:ne("Primeiros Passos Práticos"),isPaid:!0},{id:"l4",title:"Técnicas Avançadas",duration:"32:20",description:"Conceitos avançados e aplicações",thumbnail:ne("Técnicas Avançadas"),isPaid:!0}],[]);r.useEffect(()=>{if(P&&E){(async()=>{try{W(!0),X(null);const e=await y.getLessonsByCourse(E),t=(e?.Result?.lessons||[]).map(e=>({id:`l${e.id}`,title:e.title,duration:e.duration,description:e.description||"Aula prática do curso",thumbnail:`https://images.unsplash.com/photo-${Math.floor(1e9*Math.random())}?w=800&h=450&fit=crop`,isPaid:e.isPaid||!1}));J(t)}catch(e){X(e.message),J([])}finally{W(!1)}})()}},[P,E]);const ie=r.useMemo(()=>[...F.length>0?F:le].sort((e,t)=>(e.isPaid?1:0)-(t.isPaid?1:0)),[F,le]);r.useEffect(()=>{P&&F.length>0&&(z(0),R(!1),Z(null),I(0),_(0),H(null),Q(!1),$(0),se.current&&(se.current.volume=0,se.current.muted=!0))},[F,P]),r.useEffect(()=>{if(P&&ie[A]){const e=ie[A];if(e.isPaid)return Q(!1),void Z(null);const t=e.id;oe(t)}return()=>{re.current&&(re.current.destroy(),re.current=null),se.current&&(se.current.src="",se.current.volume=0,se.current.muted=!0),$(0)}},[P,A,ie]);const oe=async e=>{if(se.current)try{Q(!0),Z(null),re.current&&(re.current.destroy(),re.current=null);const r=await y.getSignedUrl(e);if(!r)throw new Error("Resposta vazia da API");if(r.includes("StatusCode"))try{const e=JSON.parse(r);if(500===e.StatusCode)return Z(`Aula não encontrada: ${e.StatusMessage}`),void Q(!1)}catch(s){}if(!r.includes("#EXTM3U"))throw new Error("Resposta não contém playlist M3U8 válido");const a=new Blob([r],{type:"application/vnd.apple.mpegurl"}),n=URL.createObjectURL(a);te(!0);const l=await(async()=>{if(ae.current)return ae.current;try{const e=(await t(()=>import("./hls-DBz5ildx.js"),[])).default;return ae.current=e,e}catch(e){throw new Error("Não foi possível carregar o player de vídeo")}})();if(te(!1),l.isSupported()){const t=new l({enableWorker:!0,lowLatencyMode:!1,maxBufferLength:60,maxMaxBufferLength:120,backBufferLength:30,maxBufferHole:.5,fetchSetup:function(t,s){if(t.url&&t.url.includes("/api/video/key")){const t=S(),s={lessonId:e};return{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(s)}}return s},xhrSetup:function(t,s){if(s&&s.includes("/api/video/key")){const r=S(),a={lessonId:e};t.open("POST",s),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",`Bearer ${r}`);const n=JSON.stringify(a),l=t.send;t.send=function(){l.call(this,n)}}}});return re.current=t,t.loadSource(n),t.attachMedia(se.current),t.on(l.Events.MANIFEST_PARSED,()=>{se.current.play().catch(e=>{})}),t.on(l.Events.ERROR,(e,t)=>{"keySystemError"!==t.type&&"keyLoadError"!==t.type?t.fatal&&Z("Erro ao carregar o vídeo"):Z("Erro ao obter chave de descriptografia. Verifique sua autenticação.")}),()=>{URL.revokeObjectURL(n)}}if(!se.current.canPlayType("application/vnd.apple.mpegurl"))throw new Error("HLS não suportado neste navegador");se.current.src=n,se.current.play().catch(e=>{})}catch(r){Z("Erro ao carregar o vídeo. Usando conteúdo de demonstração.")}finally{Q(!1),te(!1)}},ce=async()=>{if(se.current)try{T?se.current.pause():await se.current.play(),R(!T)}catch(e){"AbortError"!==e.name&&Z("Erro ao reproduzir o vídeo")}},de=e=>{if(!e||isNaN(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`};return r.useEffect(()=>{se.current&&(se.current.volume=M/100,se.current.muted=0===M)},[M,se.current]),r.useEffect(()=>{const e=se.current;if(!e)return;const t=()=>{_(e.currentTime),U(e.duration||0),I(e.duration?e.currentTime/e.duration*100:0)},s=()=>{t()};return e.addEventListener("timeupdate",t),e.addEventListener("loadedmetadata",s),e.addEventListener("seeked",t),()=>{e.removeEventListener("timeupdate",t),e.removeEventListener("loadedmetadata",s),e.removeEventListener("seeked",t)}},[se.current]),s.jsxs(v,{open:P,onOpenChange:L,children:[s.jsx(b,{asChild:!0,children:k}),s.jsx(g,{showCloseButton:!1,className:"bg-neutral-950 border-neutral-800 text-white max-w-[98vw]! w-[98vw]! h-[95dvh]! max-h-[95dvh]! overflow-hidden p-0! sm:max-w-none! sm:h-[95vh]! sm:max-h-[95vh]!",children:s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs(j,{className:"px-4 py-3 sm:px-6 sm:py-4 border-b border-neutral-800 relative",children:[s.jsx(e,{onClick:()=>L(!1),className:"absolute right-2 top-2 sm:right-4 sm:top-4 text-white hover:bg-white/20 rounded-full p-2 h-8 w-8 sm:h-10 sm:w-10",variant:"ghost",size:"icon",children:s.jsx(a,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),s.jsx(w,{className:"text-lg sm:text-xl font-bold text-white pr-12 sm:pr-16",children:C}),s.jsx(N,{className:"text-neutral-400 hidden sm:block",children:"Aulas práticas e exemplos reais"})]}),s.jsxs("div",{className:"flex flex-1 overflow-hidden flex-col sm:flex-row",children:[s.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[s.jsxs("div",{className:"relative bg-black flex items-center justify-center w-full aspect-video overflow-hidden sm:aspect-auto sm:flex-1 sm:min-h-0",children:[s.jsx("div",{className:"absolute inset-0 bg-linear-to-b from-transparent via-transparent to-black/50 z-10"}),s.jsx("video",{ref:se,className:"absolute inset-0 z-0 w-full h-full object-contain",controls:!1,playsInline:!0,muted:!0,autoPlay:!0,onPlay:()=>{R(!0),H(null)},onPause:()=>R(!1),onLoadedMetadata:()=>{D||(()=>{const e=se.current;if(!e)return;const t=document.createElement("canvas");t.width=e.videoWidth||1280,t.height=e.videoHeight||720;const s=t.getContext("2d");e.currentTime=2;const r=()=>{e.readyState>=2?(s.drawImage(e,0,0,t.width,t.height),H(t.toDataURL()),e.currentTime=0):setTimeout(r,100)};setTimeout(r,500)})()},poster:D}),!T&&D&&!K&&!Y&&s.jsxs("div",{className:"absolute inset-0 z-10",children:[s.jsx("img",{src:D,alt:"Video poster",className:"w-full h-full object-contain"}),s.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center",children:s.jsx("button",{onClick:ce,className:"bg-green-600 hover:bg-green-500 rounded-full p-6 transition-all duration-200 transform hover:scale-110 shadow-2xl backdrop-blur-sm border-2 border-white/20",children:s.jsx(n,{className:"h-12 w-12 text-white ml-1"})})})]}),ie[A]?.isPaid&&s.jsx("div",{className:"absolute inset-0 bg-black/90 flex items-center justify-center z-40",children:s.jsxs("div",{className:"text-center p-6 max-w-sm",children:[s.jsx("div",{className:"mb-6",children:s.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-linear-to-br from-green-600 to-green-500 shadow-lg shadow-green-500/25",children:s.jsx(l,{className:"h-10 w-10 text-white"})})}),s.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[s.jsx(i,{className:"h-5 w-5 text-green-400"}),s.jsx("h3",{className:"text-2xl font-bold text-green-400",children:"Conteúdo Exclusivo"}),s.jsx(i,{className:"h-5 w-5 text-green-400"})]}),s.jsx("p",{className:"text-neutral-300 mb-6 text-sm",children:"Esta aula faz parte do pacote completo do curso. Adquira acesso vitalício a todo o conteúdo."}),s.jsxs("div",{className:"space-y-2 mb-6 text-left",children:[s.jsxs("div",{className:"flex items-center gap-2 text-neutral-300 text-sm",children:[s.jsx(o,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{children:"Acesso vitalício às aulas"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-neutral-300 text-sm",children:[s.jsx(o,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{children:"Conteúdo exclusivo e avançado"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-neutral-300 text-sm",children:[s.jsx(o,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{children:"Suporte prioritário"})]})]}),s.jsxs(e,{className:"w-full bg-green-600 hover:bg-green-500 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg shadow-green-500/25 border border-green-600/30",onClick:()=>{},children:[s.jsx(i,{className:"h-4 w-4 mr-2"}),"Comprar Agora"]}),s.jsx("p",{className:"text-neutral-500 text-xs mt-4",children:"Pagamento único • Acesso vitalício"})]})}),(K||ee)&&s.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center z-30",children:s.jsxs("div",{className:"text-center",children:[s.jsx(c,{className:"h-8 w-8 animate-spin text-white mx-auto mb-2"}),s.jsx("p",{className:"text-white text-sm",children:ee?"Carregando player de vídeo...":"Carregando vídeo..."})]})}),Y&&s.jsx("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center z-30",children:s.jsxs("div",{className:"text-center p-4",children:[s.jsx("p",{className:"text-red-400 text-sm mb-2",children:Y}),s.jsx(e,{variant:"outline",size:"sm",onClick:()=>oe(ie[A].id),className:"text-white border-white/20 hover:bg-white/10",children:"Tentar novamente"})]})}),T&&0===M&&!K&&!Y&&s.jsx("div",{className:"absolute top-4 right-4 z-30 animate-pulse cursor-pointer",onClick:()=>{$(50),se.current&&(se.current.volume=.5,se.current.muted=!1)},children:s.jsxs("div",{className:"bg-red-600/90 backdrop-blur-sm rounded-lg px-3 py-2 flex items-center gap-2 border-2 border-red-400 hover:bg-red-500/90 transition-all shadow-lg shadow-red-500/30",children:[s.jsx(d,{className:"h-4 w-4 text-white"}),s.jsx("span",{className:"text-white text-sm font-bold",children:"Clique para ativar áudio"})]})}),!K&&!Y&&!D&&s.jsx("button",{onClick:ce,className:"absolute z-20 bg-white/20 backdrop-blur-sm rounded-full p-3 sm:p-4 hover:bg-white/30 transition-colors",children:T?s.jsx(u,{className:"h-6 w-6 sm:h-8 sm:w-8 text-white"}):s.jsx(n,{className:"h-6 w-6 sm:h-8 sm:w-8 text-white ml-1"})}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-linear-to-t from-black/80 to-transparent p-3 sm:p-4 z-20",children:[s.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[s.jsx(e,{variant:"ghost",size:"icon",onClick:ce,disabled:K||ee||!!Y,className:"text-white hover:bg-white/20 disabled:opacity-50",children:T?s.jsx(u,{className:"h-5 w-5"}):s.jsx(n,{className:"h-5 w-5"})}),s.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[s.jsx(m,{className:"h-4 w-4 text-white"}),s.jsx("input",{type:"range",min:"0",max:"100",value:M,onChange:e=>{const t=e.target.value;$(t),se.current&&(se.current.volume=t/100,se.current.muted=0===t)},className:"w-16 sm:w-24 h-1 bg-neutral-600 rounded-lg appearance-none cursor-pointer slider-volume",style:{background:`linear-gradient(to right, #10b981 0%, #10b981 ${M}%, #4b5563 ${M}%, #4b5563 100%)`}}),0===M&&s.jsx("div",{className:"animate-pulse cursor-pointer hover:scale-110 transition-transform",onClick:()=>{$(50),se.current&&(se.current.volume=.5,se.current.muted=!1)},children:s.jsx(d,{className:"h-4 w-4 text-red-400"})}),M>0&&s.jsx(m,{className:"h-4 w-4 text-green-400"})]}),s.jsx("span",{className:"text-white text-xs min-w-[40px]",children:de(q)}),s.jsx(e,{variant:"ghost",size:"icon",onClick:()=>{se.current&&se.current.requestFullscreen&&se.current.requestFullscreen()},className:"text-white hover:bg-white/20",children:s.jsx(x,{className:"h-5 w-5"})})]}),s.jsxs("div",{className:"mt-3",children:[s.jsx("input",{type:"range",min:"0",max:"100",value:B,onChange:e=>{const t=e.target.value;if(I(t),se.current&&se.current.duration){const e=t/100*se.current.duration;se.current.currentTime=e,_(e)}},className:"w-full h-1 bg-neutral-600 rounded-lg appearance-none cursor-pointer slider-progress",style:{background:`linear-gradient(to right, #10b981 0%, #10b981 ${B}%, #4b5563 ${B}%, #4b5563 100%)`}}),s.jsxs("div",{className:"flex justify-between mt-1",children:[s.jsx("span",{className:"text-xs text-neutral-400",children:de(q)}),s.jsx("span",{className:"text-xs text-neutral-400",children:de(O)})]})]})]})]}),s.jsxs("div",{className:"p-3 sm:p-4 border-t border-neutral-800",children:[s.jsx("h3",{className:"text-base sm:text-lg font-semibold text-white mb-2",children:ie[A].title}),s.jsx("p",{className:"text-neutral-400 text-sm",children:ie[A].description})]})]}),s.jsxs("div",{className:"w-full sm:w-80 max-h-[40dvh] sm:max-h-none border-t sm:border-t-0 sm:border-l border-neutral-800 flex flex-col min-h-0 overflow-hidden",children:[s.jsxs("div",{className:"p-3 sm:p-4 border-b border-neutral-800",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(h,{className:"h-5 w-5 text-green-400"}),s.jsx("h3",{className:"font-semibold text-white",children:"Aulas do Curso"})]}),s.jsxs("p",{className:"text-sm text-neutral-400 mt-1",children:[ie.length," aulas •"," ",ie.reduce((e,t)=>{const[s,r]=t.duration.split(":").map(Number);return e+s+r/60},0).toFixed(0),"min total"]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto",children:[V&&s.jsx("div",{className:"p-4 text-center text-neutral-400",children:"Carregando aulas..."}),G&&s.jsx("div",{className:"p-4 text-center text-red-400",children:"Erro ao carregar aulas. Exibindo conteúdo de demonstração."}),!V&&!G&&ie.map((e,t)=>s.jsx("div",{onClick:()=>(e=>{z(e),R(!1),Z(null),I(0),_(0),H(null),$(0),se.current&&(se.current.volume=0,se.current.muted=!0)})(t),className:`p-3 sm:p-4 border-b border-neutral-800 cursor-pointer transition-colors ${A===t?"bg-neutral-800":"hover:bg-neutral-900"} ${e.isPaid?"opacity-90":""}`,children:s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("div",{className:"relative shrink-0 w-16 h-10 sm:w-20 sm:h-12 rounded overflow-hidden",children:[s.jsx("img",{src:e.thumbnail||ne(e.title),alt:e.title,className:"w-full h-full object-cover",onError:t=>{t.target.src=ne(e.title)}}),A===t&&T&&!e.isPaid&&s.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:s.jsx(u,{className:"h-4 w-4 text-white"})}),e.isPaid&&s.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:s.jsx(l,{className:"h-4 w-4 text-green-400"})})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h4",{className:"font-medium text-sm truncate "+(e.isPaid?"text-green-400":"text-white"),children:e.title}),e.isPaid&&s.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[s.jsx(i,{className:"h-3 w-3 text-green-400"}),s.jsx("span",{className:"text-xs font-semibold text-green-400",children:"Premium"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx(p,{className:"h-3 w-3 text-neutral-400"}),s.jsx("span",{className:"text-xs text-neutral-400",children:e.duration})]})]})]})},e.id))]}),s.jsx("div",{className:"p-3 sm:p-4 border-t border-neutral-800",children:s.jsxs(e,{variant:"ghost",className:"w-full border border-green-600/30 text-green-400 bg-neutral-900/50 hover:bg-green-600/10 hover:text-green-300",children:[s.jsx(f,{className:"h-4 w-4 mr-2"}),"Recursos do Curso"]})})]})]})]})})]})}export{C as VideoStreamingDialog,C as default};
